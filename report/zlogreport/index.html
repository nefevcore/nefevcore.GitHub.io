
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.4.4">
    
    
      
        <title>日志查询报表 - ABAP开发笔记</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6b80c2a2.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ABAP开发笔记" class="md-header__button md-logo" aria-label="ABAP开发笔记" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ABAP开发笔记
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              日志查询报表
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ABAP开发笔记" class="md-nav__button md-logo" aria-label="ABAP开发笔记" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ABAP开发笔记
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        概述
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../log/" class="md-nav__link">
        更新
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          主数据
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="主数据" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          主数据
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../master_data/" class="md-nav__link">
        主数据概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../master_data/material/" class="md-nav__link">
        物料
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../master_data/bp/" class="md-nav__link">
        业务伙伴
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../master_data/bom/" class="md-nav__link">
        BOM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../master_data/work_center/" class="md-nav__link">
        工作中心
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          GTM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="GTM" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          GTM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gtm/" class="md-nav__link">
        GTM模块概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gtm/wtew/" class="md-nav__link">
        WTEW
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gtm/contract/" class="md-nav__link">
        合同
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gtm/contract_assoc/" class="md-nav__link">
        合同关联
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gtm/contract_approval/" class="md-nav__link">
        合同审批
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          MM
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="MM" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          MM
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mm/" class="md-nav__link">
        MM模块概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mm/purchase/" class="md-nav__link">
        采购订单
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mm/inbound_delivery/" class="md-nav__link">
        内向交货单
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mm/inbound_delivery_post/" class="md-nav__link">
        收货过账
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          SD
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="SD" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          SD
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sd/" class="md-nav__link">
        SD模块概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sd/sale_document/" class="md-nav__link">
        销售订单
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sd/outbound_delivery/" class="md-nav__link">
        外向交货单
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sd/outbound_delivery_post/" class="md-nav__link">
        发货过账
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../sd/sale_doc_screen_enhancement/" class="md-nav__link">
        销售屏幕增强
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          PP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="PP" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          PP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pp/" class="md-nav__link">
        PP模块概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pp/pp_routing/" class="md-nav__link">
        工艺路线
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pp/pir/" class="md-nav__link">
        PIR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pp/mrp/" class="md-nav__link">
        MRP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pp/pp_version/" class="md-nav__link">
        生产版本
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pp/pp_planning/" class="md-nav__link">
        生产计划
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pp/pp_order/" class="md-nav__link">
        生产工单
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pp/pp_confirmation/" class="md-nav__link">
        报工确认
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pp/pp_gr/" class="md-nav__link">
        生产订单收货
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pp/pp_gi/" class="md-nav__link">
        领退料
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pp/pp_order_close/" class="md-nav__link">
        工单关闭
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          FICO
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="FICO" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          FICO
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fico/" class="md-nav__link">
        FICO模块概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fico/acc_document/" class="md-nav__link">
        会计凭证
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fico/invoice_check/" class="md-nav__link">
        发票校验
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fico/invoice_park/" class="md-nav__link">
        发票预制
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fico/invoice_post/" class="md-nav__link">
        发票过账
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fico/fi_clearing_account/" class="md-nav__link">
        清账
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8_7" type="checkbox" id="__nav_8_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8_7">
          三大报表
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="三大报表" data-md-level="2">
        <label class="md-nav__title" for="__nav_8_7">
          <span class="md-nav__icon md-icon"></span>
          三大报表
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fico/fi_report/" class="md-nav__link">
        通用取值模块
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fico/fi_report_config/" class="md-nav__link">
        配置表参考
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fico/fi_report_bs/" class="md-nav__link">
        资产负债表
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fico/fi_report_pl/" class="md-nav__link">
        利润表
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fico/fi_report_cf/" class="md-nav__link">
        现金流量表
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fico/fixed_assets_report/" class="md-nav__link">
        固定资产明细报表
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fico/ckw1/" class="md-nav__link">
        批量WBS成本核算
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          多模块复用
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="多模块复用" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          多模块复用
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../others/migo/" class="md-nav__link">
        MIGO
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../others/pricing/" class="md-nav__link">
        定价
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../others/billing_enhancement/" class="md-nav__link">
        发票增强
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_10" type="checkbox" id="__nav_10" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_10">
          报表
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="报表" data-md-level="1">
        <label class="md-nav__title" for="__nav_10">
          <span class="md-nav__icon md-icon"></span>
          报表
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        报表概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../stock/" class="md-nav__link">
        库存报表
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        日志查询报表
      </a>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_11" type="checkbox" id="__nav_11" >
      
      
      
      
        <label class="md-nav__link" for="__nav_11">
          其他
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="其他" data-md-level="1">
        <label class="md-nav__title" for="__nav_11">
          <span class="md-nav__icon md-icon"></span>
          其他
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../others/" class="md-nav__link">
        其他概述
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../others/alv/" class="md-nav__link">
        ALV相关
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../others/xlsx_io/" class="md-nav__link">
        Excel上传下载
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../others/zcl_text/" class="md-nav__link">
        文本取值工具
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../others/smartforms/" class="md-nav__link">
        SMARTFORMS相关
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../others/number_to_chinese/" class="md-nav__link">
        中文大写
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../others/nest_loop/" class="md-nav__link">
        嵌套循环
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../others/send_mail/" class="md-nav__link">
        邮件发送
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../others/cmod/" class="md-nav__link">
        CMOD增强
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../others/zdataimport/" class="md-nav__link">
        导表程序
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        结语
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_13" type="checkbox" id="__nav_13" >
      
      
      
      
        <label class="md-nav__link" for="__nav_13">
          附录
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="附录" data-md-level="1">
        <label class="md-nav__title" for="__nav_13">
          <span class="md-nav__icon md-icon"></span>
          附录
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../ex/mdnote/" class="md-nav__link">
        MarkDown语法
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="_1">日志查询程序<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<p>该程序用于查询接口日志，并已加入PO日志查询（仅限系统内存储的日志数据），如有自定义日志数据想要展示，需要继承本地接口LIF_LOG，并实施接口方法。</p>
<blockquote>
<p>报表执行时会检索实例类，因此无需手工创建新的日志实例（CREATE OBJECT，NEW #()等）。</p>
</blockquote>
<details>
  <summary>示例代码</summary>

<div class="highlight"><pre><span></span><code><span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; REPORT ZLOGREPORT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; V2 - XIAOFENG - 2022-09-26 14:11:17</span><span class="w"></span>
<span class="c1">*&amp; 上个项目的那版写得太复杂，无法扩展，这次乘机简化下代码</span><span class="w"></span>
<span class="c1">*&amp; 使用步骤：</span><span class="w"></span>
<span class="c1">*&amp;  1 代码复制粘贴</span><span class="w"></span>
<span class="c1">*&amp;  2 创建9000屏幕，添加一个容器（属性改自适应），命名CON_9000</span><span class="w"></span>
<span class="c1">*&amp;  3 创建状态栏STATUS</span><span class="w"></span>
<span class="c1">*&amp;   3.1 添加三个退出按钮（&amp;F03\&amp;F15\&amp;F12）</span><span class="w"></span>
<span class="c1">*&amp;   3.2 添加REDO按钮，用于错误数据重处理，没有的话忽略即可</span><span class="w"></span>
<span class="c1">*&amp;  4 新建实施类，继承接口LIF_LOG，把接口方法实施即可</span><span class="w"></span>
<span class="c1">*&amp;   4.1 GET_LOG_KIND，为每种日志设定唯一名称</span><span class="w"></span>
<span class="c1">*&amp;   4.2 GET_DATA，查询日志数据，写入到GT_LOG和GT_LOG_RAWDATA中（弹窗用）</span><span class="w"></span>
<span class="c1">*&amp;   4.3 REDO，错误重处理</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">REPORT</span><span class="w"> </span><span class="nv">ZLOGREPORT</span><span class="w"></span>

<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; 本地类声明</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_progress</span><span class="w"> </span><span class="k">DEFINITION</span><span class="w"> </span><span class="k">DEFERRED</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 进度条</span>
<span class="c1">&quot; 数据处理相关</span>
<span class="k">INTERFACE</span><span class="w"> </span><span class="nv">lif_unit_parser</span><span class="w"> </span><span class="k">DEFERRED</span><span class="p">.</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_data_unit_parser</span><span class="w"> </span><span class="k">DEFINITION</span><span class="w"> </span><span class="k">DEFERRED</span><span class="p">.</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_json_unit_parser</span><span class="w"> </span><span class="k">DEFINITION</span><span class="w"> </span><span class="k">DEFERRED</span><span class="p">.</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_xml_unit_parser</span><span class="w"> </span><span class="k">DEFINITION</span><span class="w"> </span><span class="k">DEFERRED</span><span class="p">.</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_unit_helper</span><span class="w"> </span><span class="k">DEFINITION</span><span class="w"> </span><span class="k">DEFERRED</span><span class="p">.</span><span class="w"></span>
<span class="c1">&quot; ALV相关</span>
<span class="k">INTERFACE</span><span class="w"> </span><span class="nv">lif_alv</span><span class="w"> </span><span class="k">DEFERRED</span><span class="p">.</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_alv_logh</span><span class="w"> </span><span class="k">DEFINITION</span><span class="w"> </span><span class="k">DEFERRED</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 日志抬头数据展示</span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_alv_unit</span><span class="w"> </span><span class="k">DEFINITION</span><span class="w"> </span><span class="k">DEFERRED</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 单元数据展示</span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_alv_flat</span><span class="w"> </span><span class="k">DEFINITION</span><span class="w"> </span><span class="k">DEFERRED</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 扁平结构展示</span>
<span class="c1">&quot; 日志处理相关</span>
<span class="k">INTERFACE</span><span class="w"> </span><span class="nv">lif_log</span><span class="w"> </span><span class="k">DEFERRED</span><span class="p">.</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_log_po</span><span class="w"> </span><span class="k">DEFINITION</span><span class="w"> </span><span class="k">DEFERRED</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; PO日志</span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_log_custom</span><span class="w"> </span><span class="k">DEFINITION</span><span class="w"> </span><span class="k">DEFERRED</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 自定义日志</span>

<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; 类型定义</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">&quot; 数据单元，简单来说，一个值就是一个单元</span>
<span class="k">TYPES</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="k">BEGIN OF</span><span class="w"> </span><span class="nv">ty_unit</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">path</span><span class="w">  </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 路径</span>
<span class="w">    </span><span class="k">key</span><span class="w">   </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 键</span>
<span class="w">    </span><span class="k">value</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 值</span>
<span class="w">  </span><span class="k">END OF</span><span class="w"> </span><span class="nv">ty_unit</span><span class="p">.</span><span class="w"></span>
<span class="k">TYPES</span><span class="w"> </span><span class="nv">tt_unit</span><span class="w"> </span><span class="k">TYPE STANDARD TABLE OF</span><span class="w"> </span><span class="nv">ty_unit</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="nv">EMPTY</span><span class="w"> </span><span class="k">KEY</span><span class="p">.</span><span class="w"></span>
<span class="c1">&quot; 扁平结构信息</span>
<span class="k">TYPES</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="k">BEGIN OF</span><span class="w"> </span><span class="nv">ty_flatdt</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">struct</span><span class="w">   </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 结构</span>
<span class="w">    </span><span class="k">field</span><span class="w">    </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 字段</span>
<span class="w">    </span><span class="k">position</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">i</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 位置</span>
<span class="w">  </span><span class="k">END OF</span><span class="w"> </span><span class="nv">ty_flatdt</span><span class="p">.</span><span class="w"></span>
<span class="k">TYPES</span><span class="w"> </span><span class="nv">tt_flatdt</span><span class="w"> </span><span class="k">TYPE STANDARD TABLE OF</span><span class="w"> </span><span class="nv">ty_flatdt</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="nv">EMPTY</span><span class="w"> </span><span class="k">KEY</span><span class="p">.</span><span class="w"></span>
<span class="c1">&quot; 数据单元扩展</span>
<span class="k">TYPES</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="k">BEGIN OF</span><span class="w"> </span><span class="nv">ty_unitex</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 创建扁平结构用到</span>
<span class="w">    </span><span class="nv">struct</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 结构</span>
<span class="w">    </span><span class="nv">path</span><span class="w">   </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 路径</span>
<span class="w">    </span><span class="k">key</span><span class="w">    </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 键</span>
<span class="w">    </span><span class="k">value</span><span class="w">  </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 值</span>
<span class="w">  </span><span class="k">END OF</span><span class="w"> </span><span class="nv">ty_unitex</span><span class="p">.</span><span class="w"></span>
<span class="k">TYPES</span><span class="w"> </span><span class="nv">tt_unitex</span><span class="w"> </span><span class="k">TYPE STANDARD TABLE OF</span><span class="w"> </span><span class="nv">ty_unitex</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="nv">EMPTY</span><span class="w"> </span><span class="k">KEY</span><span class="p">.</span><span class="w"></span>
<span class="c1">&quot; 日志抬头信息</span>
<span class="k">TYPES</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="k">BEGIN OF</span><span class="w"> </span><span class="nv">ty_log_head</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">uuid</span><span class="w">      </span><span class="k">TYPE </span><span class="nv">sysuuid_c32</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 日志ID</span>
<span class="w">    </span><span class="nv">zitem</span><span class="w">     </span><span class="k">TYPE </span><span class="nv">i</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 序号</span>
<span class="w">    </span><span class="nv">log_kind</span><span class="w">  </span><span class="k">TYPE </span><span class="nv">c</span><span class="w"> </span><span class="k">LENGTH</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 日志种类，如PI日志，日志等多种</span>
<span class="w">    </span><span class="nv">intf_id</span><span class="w">   </span><span class="k">TYPE </span><span class="nv">c</span><span class="w"> </span><span class="k">LENGTH</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 接口标识</span>
<span class="w">    </span><span class="nv">func_name</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">rs38l_fnam</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 函数名</span>
<span class="w">    </span><span class="nv">func_text</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">c</span><span class="w"> </span><span class="k">LENGTH</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 函数描述</span>
<span class="w">    </span><span class="nv">ztext</span><span class="w">     </span><span class="k">TYPE </span><span class="nv">c</span><span class="w"> </span><span class="k">LENGTH</span><span class="w"> </span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 附加信息，有些接口会在记录的时候附加一些描述说明</span>
<span class="w">    </span><span class="nv">io_flag</span><span class="w">   </span><span class="k">TYPE </span><span class="nv">c</span><span class="w"> </span><span class="k">LENGTH</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 入参或出参</span>
<span class="w">    </span><span class="nv">zconut</span><span class="w">    </span><span class="k">TYPE </span><span class="nv">i</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 条目统计</span>
<span class="w">    </span><span class="nv">zsender</span><span class="w">   </span><span class="k">TYPE </span><span class="nv">c</span><span class="w"> </span><span class="k">LENGTH</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 发送方</span>
<span class="w">    </span><span class="nv">zreceiver</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">c</span><span class="w"> </span><span class="k">LENGTH</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 接受方</span>
<span class="w">    </span><span class="nv">zraw_icon</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">icon_d</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 双击展示原始数据</span>
<span class="w">    </span><span class="nv">zdate</span><span class="w">     </span><span class="k">TYPE </span><span class="nv">datum</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 日期</span>
<span class="w">    </span><span class="nv">ztime</span><span class="w">     </span><span class="k">TYPE </span><span class="nv">uzeit</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 时间</span>
<span class="w">    </span><span class="nv">zuser</span><span class="w">     </span><span class="k">TYPE </span><span class="nv">uname</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 用户</span>
<span class="w">    </span><span class="nv">mtype</span><span class="w">     </span><span class="k">TYPE </span><span class="nv">bapi_mtype</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 状态</span>
<span class="w">    </span><span class="nv">msg</span><span class="w">       </span><span class="k">TYPE </span><span class="nv">bapi_msg</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 消息文本</span>
<span class="w">    </span><span class="nv">rcol</span><span class="w">      </span><span class="k">TYPE </span><span class="nv">c</span><span class="w"> </span><span class="k">LENGTH</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 行颜色</span>
<span class="w">    </span><span class="nv">t_scol</span><span class="w">    </span><span class="k">TYPE </span><span class="nv">lvc_t_scol</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 单元格颜色</span>
<span class="w">    </span><span class="nv">t_styl</span><span class="w">    </span><span class="k">TYPE </span><span class="nv">lvc_t_styl</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 单元格样式</span>
<span class="w">  </span><span class="k">END OF</span><span class="w"> </span><span class="nv">ty_log_head</span><span class="p">.</span><span class="w"></span>
<span class="c1">&quot; 日志数据</span>
<span class="k">TYPES</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="k">BEGIN OF</span><span class="w"> </span><span class="nv">ty_log_data</span><span class="p">,</span><span class="w"></span>
<span class="c1">*    r_data     TYPE REF TO data, &quot; 日志数据</span><span class="w"></span>
<span class="w">    </span><span class="nv">t_unit</span><span class="w">     </span><span class="k">TYPE </span><span class="nv">tt_unit</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 数据单元</span>
<span class="w">    </span><span class="nv">r_flatdata</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="k">data</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 扁平结构数据</span>
<span class="w">    </span><span class="nv">t_flatdt</span><span class="w">   </span><span class="k">TYPE </span><span class="nv">tt_flatdt</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 扁平结构</span>
<span class="w">  </span><span class="k">END OF</span><span class="w"> </span><span class="nv">ty_log_data</span><span class="p">.</span><span class="w"></span>
<span class="k">TYPES</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="k">BEGIN OF</span><span class="w"> </span><span class="nv">ty_log</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INCLUDE</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_log_head</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INCLUDE</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_log_data</span><span class="p">.</span><span class="w"></span>
<span class="k">TYPES</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="k">END OF</span><span class="w"> </span><span class="nv">ty_log</span><span class="p">.</span><span class="w"></span>
<span class="k">TYPES</span><span class="w"> </span><span class="nv">tt_log</span><span class="w"> </span><span class="k">TYPE STANDARD TABLE OF</span><span class="w"> </span><span class="nv">ty_log</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="c1">&quot; 日志原始数据</span>
<span class="k">TYPES</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="k">BEGIN OF</span><span class="w"> </span><span class="nv">ty_log_rawdata</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">uuid</span><span class="w">    </span><span class="k">TYPE </span><span class="nv">sysuuid_c32</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 日志ID</span>
<span class="w">    </span><span class="nv">zitem</span><span class="w">   </span><span class="k">TYPE </span><span class="nv">i</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 序号</span>
<span class="w">    </span><span class="nv">zformat</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">c</span><span class="w"> </span><span class="k">LENGTH</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 原始数据格式</span>
<span class="w">    </span><span class="nv">zraw</span><span class="w">    </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 原始数据</span>
<span class="w">    </span><span class="nv">zrawx</span><span class="w">   </span><span class="k">TYPE </span><span class="nv">xstring</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 原始数据</span>
<span class="w">  </span><span class="k">END OF</span><span class="w"> </span><span class="nv">ty_log_rawdata</span><span class="p">.</span><span class="w"></span>
<span class="k">TYPES</span><span class="w"> </span><span class="nv">tt_log_rawdata</span><span class="w"> </span><span class="k">TYPE STANDARD TABLE OF</span><span class="w"> </span><span class="nv">ty_log_rawdata</span><span class="w"> </span><span class="p">.</span><span class="w"></span>

<span class="k">TYPES</span><span class="w"> </span><span class="nv">tt_uuid</span><span class="w"> </span><span class="k">TYPE STANDARD TABLE OF</span><span class="w"> </span><span class="nv">ty_log_head</span><span class="o">-</span><span class="nv">uuid</span><span class="p">.</span><span class="w"></span>
<span class="k">TYPES</span><span class="w"> </span><span class="nv">tt_uuid_opt</span><span class="w"> </span><span class="k">TYPE RANGE OF</span><span class="w"> </span><span class="nv">ty_log_head</span><span class="o">-</span><span class="nv">uuid</span><span class="p">.</span><span class="w"></span>

<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; 数据声明</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">DATA</span><span class="w"> </span><span class="nv">gt_log</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">tt_log</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 日志数据</span>
<span class="k">DATA</span><span class="w"> </span><span class="nv">gt_log_rawdata</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">tt_log_rawdata</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 日志数据</span>
<span class="k">DATA</span><span class="w"> </span><span class="nv">gt_log_impl</span><span class="w"> </span><span class="k">TYPE STANDARD TABLE OF</span><span class="w"> </span><span class="k">REF TO</span><span class="w"> </span><span class="nv">lif_log</span><span class="p">.</span><span class="w"></span>

<span class="k">DATA</span><span class="w"> </span><span class="nv">go_alv</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">lif_alv</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; ALV对象</span>
<span class="k">DATA</span><span class="w"> </span><span class="nv">go_container</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">cl_gui_container</span><span class="p">.</span><span class="w"></span>
<span class="k">DATA</span><span class="w"> </span><span class="nv">go_grid</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">cl_gui_alv_grid</span><span class="p">.</span><span class="w"></span>

<span class="k">DATA</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="k">BEGIN OF</span><span class="w"> </span><span class="nv">gs_fieldname</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">fdlk</span><span class="w">  </span><span class="k">TYPE </span><span class="nv">string</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="s1">&#39;FDLK&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; FLAT_DATA_LINE_KIND</span>
<span class="w">    </span><span class="nv">path</span><span class="w">  </span><span class="k">TYPE </span><span class="nv">string</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="s1">&#39;PATH&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">field</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">string</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="s1">&#39;__FIELD&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="k">END OF</span><span class="w"> </span><span class="nv">gs_fieldname</span><span class="p">.</span><span class="w"></span>

<span class="k">DATA</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="k">BEGIN OF</span><span class="w"> </span><span class="nv">gs_fdlk</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">header</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">string</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="s1">&#39;HEADER&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="k">data</span><span class="w">   </span><span class="k">TYPE </span><span class="nv">string</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="s1">&#39;DATA&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="k">END OF</span><span class="w"> </span><span class="nv">gs_fdlk</span><span class="p">.</span><span class="w"></span>

<span class="k">DATA</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="k">BEGIN OF</span><span class="w"> </span><span class="nv">gs_color</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">blue</span><span class="w">        </span><span class="k">TYPE </span><span class="nv">lvc_s_colo</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">yellow</span><span class="w">      </span><span class="k">TYPE </span><span class="nv">lvc_s_colo</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">green</span><span class="w">       </span><span class="k">TYPE </span><span class="nv">lvc_s_colo</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">red</span><span class="w">         </span><span class="k">TYPE </span><span class="nv">lvc_s_colo</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">dept_blue</span><span class="w">   </span><span class="k">TYPE </span><span class="nv">lvc_s_colo</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">dept_yellow</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_s_colo</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">dept_green</span><span class="w">  </span><span class="k">TYPE </span><span class="nv">lvc_s_colo</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="nv">dept_red</span><span class="w">    </span><span class="k">TYPE </span><span class="nv">lvc_s_colo</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="k">END OF</span><span class="w"> </span><span class="nv">gs_color</span><span class="p">.</span><span class="w"></span>

<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; 选择屏幕</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">TABLES</span><span class="w"> </span><span class="nv">sxmspmast</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; PO相关</span>
<span class="k">TABLES</span><span class="w"> </span><span class="nv">sxmspemas</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; PO相关</span>
<span class="c1">&quot; 选择条件</span>
<span class="k">DATA</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="k">BEGIN OF</span><span class="w"> </span><span class="nv">gs_selection</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INCLUDE</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_log_head</span><span class="p">.</span><span class="w"></span>
<span class="k">DATA</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nv">intfid</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">char30</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; 自定义日志接口标识</span>
<span class="c1">*    INCLUDE TYPE ty_unit.</span><span class="w"></span>
<span class="w">    </span><span class="k">field</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">char30</span><span class="p">,</span><span class="w"> </span><span class="c1">&quot; TY_UNIT-FIELD，STRING类型的，不能使用</span>
<span class="w">    </span><span class="k">value</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">char30</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; TY_UNIT-VALUE，STRING类型的，不能使用</span>
<span class="k">DATA</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="k">END OF</span><span class="w"> </span><span class="nv">gs_selection</span><span class="p">.</span><span class="w"></span>
<span class="c1">&quot; 自定义选择条件</span>
<span class="k">SELECTION-SCREEN BEGIN OF BLOCK</span><span class="w"> </span><span class="nv">b900</span><span class="w"> </span><span class="k">WITH FRAME</span><span class="w"> </span><span class="k">TITLE</span><span class="w"> </span><span class="nv">b900</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PARAMETERS</span><span class="w"> </span><span class="nv">p_custom</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">xflag</span><span class="w"> </span><span class="k">AS CHECKBOX</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;X&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">SELECT-OPTIONS</span><span class="w"> </span><span class="nv">s_intfid</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="nv">gs_selection</span><span class="o">-</span><span class="nv">intfid</span><span class="p">.</span><span class="w"></span>
<span class="k">SELECTION-SCREEN END OF BLOCK</span><span class="w"> </span><span class="nv">b900</span><span class="p">.</span><span class="w"></span>
<span class="c1">&quot; 通用选择条件</span>
<span class="k">SELECTION-SCREEN BEGIN OF BLOCK</span><span class="w"> </span><span class="nv">b100</span><span class="w"> </span><span class="k">WITH FRAME</span><span class="w"> </span><span class="k">TITLE</span><span class="w"> </span><span class="nv">b100</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">SELECT-OPTIONS</span><span class="w"> </span><span class="nv">s_uuid</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="nv">gs_selection</span><span class="o">-</span><span class="nv">uuid</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">SELECT-OPTIONS</span><span class="w"> </span><span class="nv">s_func</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="nv">gs_selection</span><span class="o">-</span><span class="nv">func_name</span><span class="w"> </span><span class="k">MATCHCODE OBJECT</span><span class="w"> </span><span class="nv">sfunc_modules</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">SELECT-OPTIONS</span><span class="w"> </span><span class="nv">s_snd</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="nv">gs_selection</span><span class="o">-</span><span class="nv">zsender</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">SELECT-OPTIONS</span><span class="w"> </span><span class="nv">s_rcv</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="nv">gs_selection</span><span class="o">-</span><span class="nv">zreceiver</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">SELECT-OPTIONS</span><span class="w"> </span><span class="nv">s_user</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="nv">gs_selection</span><span class="o">-</span><span class="nv">zuser</span><span class="w"> </span><span class="k">MATCHCODE OBJECT</span><span class="w"> </span><span class="nv">user_comp</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">SELECT-OPTIONS</span><span class="w"> </span><span class="nv">s_date</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="nv">gs_selection</span><span class="o">-</span><span class="nv">zdate</span><span class="w"> </span><span class="k">NO-EXTENSION</span><span class="w"> </span><span class="k">OBLIGATORY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">datum</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">SELECT-OPTIONS</span><span class="w"> </span><span class="nv">s_time</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="nv">gs_selection</span><span class="o">-</span><span class="nv">ztime</span><span class="w"> </span><span class="k">NO-EXTENSION</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">SELECT-OPTIONS</span><span class="w"> </span><span class="nv">s_mtype</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="nv">gs_selection</span><span class="o">-</span><span class="nv">mtype</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="c1">&quot; PO选择条件</span>
<span class="w">  </span><span class="k">SELECTION-SCREEN BEGIN OF BLOCK</span><span class="w"> </span><span class="nv">b102</span><span class="w"> </span><span class="k">WITH FRAME</span><span class="w"> </span><span class="k">TITLE</span><span class="w"> </span><span class="nv">b102</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">PARAMETERS</span><span class="w"> </span><span class="nv">p_po</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">xflag</span><span class="w"> </span><span class="k">AS CHECKBOX</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;X&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">SELECT-OPTIONS</span><span class="w"> </span><span class="nv">s_siname</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="nv">sxmspemas</span><span class="o">-</span><span class="nv">ob_name</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">SELECTION-SCREEN END OF BLOCK</span><span class="w"> </span><span class="nv">b102</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="c1">&quot; 扩展选择条件</span>
<span class="w">  </span><span class="k">SELECTION-SCREEN BEGIN OF BLOCK</span><span class="w"> </span><span class="nv">b101</span><span class="w"> </span><span class="k">WITH FRAME</span><span class="w"> </span><span class="k">TITLE</span><span class="w"> </span><span class="nv">b101</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">SELECT-OPTIONS</span><span class="w"> </span><span class="nv">s_field</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="nv">gs_selection</span><span class="o">-</span><span class="nv">field</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">SELECT-OPTIONS</span><span class="w"> </span><span class="nv">s_value</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="nv">gs_selection</span><span class="o">-</span><span class="nv">value</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">SELECTION-SCREEN END OF BLOCK</span><span class="w"> </span><span class="nv">b101</span><span class="p">.</span><span class="w"></span>
<span class="k">SELECTION-SCREEN END OF BLOCK</span><span class="w"> </span><span class="nv">b100</span><span class="p">.</span><span class="w"></span>
<span class="c1">&quot; 展示方式</span>
<span class="k">SELECTION-SCREEN BEGIN OF BLOCK</span><span class="w"> </span><span class="nv">b200</span><span class="w"> </span><span class="k">WITH FRAME</span><span class="w"> </span><span class="k">TITLE</span><span class="w"> </span><span class="nv">b200</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PARAMETERS</span><span class="w"> </span><span class="nv">p_logh</span><span class="w"> </span><span class="k">RADIOBUTTON GROUP</span><span class="w"> </span><span class="nv">rg1</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">xflag</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;X&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PARAMETERS</span><span class="w"> </span><span class="nv">p_flat</span><span class="w"> </span><span class="k">RADIOBUTTON GROUP</span><span class="w"> </span><span class="nv">rg1</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">xflag</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PARAMETERS</span><span class="w"> </span><span class="nv">p_unit</span><span class="w"> </span><span class="k">RADIOBUTTON GROUP</span><span class="w"> </span><span class="nv">rg1</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">xflag</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">SELECTION-SCREEN BEGIN OF BLOCK</span><span class="w"> </span><span class="nv">b201</span><span class="w"> </span><span class="k">WITH FRAME</span><span class="w"> </span><span class="k">TITLE</span><span class="w"> </span><span class="nv">b201</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">PARAMETERS</span><span class="w"> </span><span class="nv">p_ctl1</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">xflag</span><span class="w"> </span><span class="k">AS CHECKBOX</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 紧凑表示</span>
<span class="w">    </span><span class="k">PARAMETERS</span><span class="w"> </span><span class="nv">p_ctl2</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">xflag</span><span class="w"> </span><span class="k">AS CHECKBOX</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;X&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">PARAMETERS</span><span class="w"> </span><span class="nv">p_ctl3</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">xflag</span><span class="w"> </span><span class="k">AS CHECKBOX</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;X&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">PARAMETERS</span><span class="w"> </span><span class="nv">p_ctl4</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">xflag</span><span class="w"> </span><span class="k">AS CHECKBOX</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;X&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">PARAMETERS</span><span class="w"> </span><span class="nv">p_ctl5</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">i</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">SELECTION-SCREEN END OF BLOCK</span><span class="w"> </span><span class="nv">b201</span><span class="p">.</span><span class="w"></span>
<span class="k">SELECTION-SCREEN END OF BLOCK</span><span class="w"> </span><span class="nv">b200</span><span class="p">.</span><span class="w"></span>

<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; 本地类定义</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; CLASS LCL_PROGRESS</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_progress</span><span class="w"> </span><span class="k">DEFINITION</span><span class="w"> </span><span class="nv">FINAL</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PUBLIC SECTION</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">m_total</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">i</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">m_current</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">i</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">m_time_start</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">timestampl</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">m_time</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">timestampl</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">m_interval</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">i</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">m_name</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">string</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">start</span><span class="w"> </span><span class="c1">&quot; 初始化</span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"> </span><span class="nv">total</span><span class="w">         </span><span class="k">TYPE </span><span class="nv">i</span><span class="w"> </span><span class="nv">OPTIONAL</span><span class="w"></span>
<span class="w">      </span><span class="k">RETURNING</span><span class="w"> </span><span class="k">VALUE</span><span class="p">(</span><span class="nv">result</span><span class="p">)</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">lcl_progress</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="k">next</span><span class="w"> </span><span class="c1">&quot; 增加一点进度</span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"> </span><span class="nv">delta</span><span class="w">         </span><span class="k">TYPE </span><span class="nv">i</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">      </span><span class="k">RETURNING</span><span class="w"> </span><span class="k">VALUE</span><span class="p">(</span><span class="nv">result</span><span class="p">)</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">lcl_progress</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">finish</span><span class="w"> </span><span class="c1">&quot; 结束</span>
<span class="w">      </span><span class="k">RETURNING</span><span class="w"> </span><span class="k">VALUE</span><span class="p">(</span><span class="nv">result</span><span class="p">)</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">lcl_progress</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">show</span><span class="w"> </span><span class="c1">&quot; 左下角消息</span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"> </span><span class="nv">text</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">string</span><span class="w"> </span><span class="nv">OPTIONAL</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="k">percentage</span><span class="w"> </span><span class="c1">&quot; 当前进度</span>
<span class="w">      </span><span class="k">RETURNING</span><span class="w"> </span><span class="k">VALUE</span><span class="p">(</span><span class="nv">result</span><span class="p">)</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">f</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">duration</span><span class="w">  </span><span class="c1">&quot; 运行时间</span>
<span class="w">      </span><span class="k">RETURNING</span><span class="w"> </span><span class="k">VALUE</span><span class="p">(</span><span class="nv">result</span><span class="p">)</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">f</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CLASS-METHODS</span><span class="w"> </span><span class="nv">step</span><span class="w"> </span><span class="c1">&quot; 展示单个条目</span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"> </span><span class="nv">text</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">string</span><span class="w"> </span><span class="nv">OPTIONAL</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; CLASS (IMPLEMENTATION) LCL_PROGRESS</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_progress</span><span class="w"> </span><span class="k">IMPLEMENTATION</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; START</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">start</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">me</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">m_total</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">total</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">m_interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">m_interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 不加限制反而影响性能</span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">m_current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">GET TIME STAMP</span><span class="w"> </span><span class="k">FIELD</span><span class="w"> </span><span class="nv">m_time_start</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">m_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">m_time_start</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; NEXT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">next</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">me</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">m_current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">m_current</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nv">delta</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_time</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">timestampl</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">GET TIME STAMP</span><span class="w"> </span><span class="k">FIELD</span><span class="w"> </span><span class="nv">l_time</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">m_current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">m_total</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">m_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_time</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">m_time</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nv">l_time</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">show</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">m_interval</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">m_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cl_abap_tstmp</span><span class="o">=&gt;</span><span class="nf">add</span><span class="p">(</span><span class="w"> </span><span class="nv">tstmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_time</span><span class="w"></span>
<span class="w">                                     </span><span class="nv">secs</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">m_interval</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">m_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_time</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; FINISH</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">finish</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">me</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">GET TIME STAMP</span><span class="w"> </span><span class="k">FIELD</span><span class="w"> </span><span class="nv">m_time</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">show</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; SHOW</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">show</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="p">(</span><span class="nv">l_text</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">text</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">l_text</span><span class="w"> </span><span class="ow">IS INITIAL</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">l_text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">|{</span><span class="w"> </span><span class="k">percentage</span><span class="p">(</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">DECIMALS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="s1">% [ </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nv">m_current</span><span class="w"> </span><span class="k">NUMBER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">USER</span><span class="w"> </span><span class="p">}</span><span class="s1"> / </span><span class="p">{</span><span class="w"> </span><span class="nv">m_total</span><span class="w"> </span><span class="k">NUMBER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">USER</span><span class="w"> </span><span class="p">}</span><span class="s1"> ] </span><span class="p">{</span><span class="w"></span>
<span class="w">          </span><span class="nv">duration</span><span class="p">(</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">DECIMALS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="s1">S</span><span class="p">|.</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">m_name</span><span class="w"> </span><span class="ow">IS NOT INITIAL</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">l_text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">|{</span><span class="w"> </span><span class="nv">m_name</span><span class="w"> </span><span class="p">}</span><span class="s1"> : </span><span class="p">{</span><span class="w"> </span><span class="nv">l_text</span><span class="w"> </span><span class="p">}|.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">batch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CALL FUNCTION</span><span class="w"> </span><span class="s1">&#39;SAPGUI_PROGRESS_INDICATOR&#39;</span><span class="w"></span>
<span class="w">        </span><span class="k">EXPORTING</span><span class="w"></span>
<span class="w">          </span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_text</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ELSE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">MESSAGE</span><span class="w"> </span><span class="nv">l_text</span><span class="w"> </span><span class="nv">TYPE</span><span class="w"> </span><span class="s1">&#39;S&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; PERCENTAGE</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">percentage</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">m_total</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">m_current</span><span class="w"> </span><span class="p">/</span><span class="w"> </span><span class="nv">m_total</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; DURATION</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">duration</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cl_abap_tstmp</span><span class="o">=&gt;</span><span class="nf">subtract</span><span class="p">(</span><span class="w"> </span><span class="nv">tstmp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">m_time</span><span class="w"> </span><span class="nv">tstmp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">m_time_start</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; STEP</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">step</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CALL FUNCTION</span><span class="w"> </span><span class="s1">&#39;SAPGUI_PROGRESS_INDICATOR&#39;</span><span class="w"></span>
<span class="w">      </span><span class="k">EXPORTING</span><span class="w"></span>
<span class="w">        </span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">text</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>

<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LIF_UNIT_PARSER DEFINITION</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">INTERFACE</span><span class="w"> </span><span class="nv">lif_unit_parser</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">parse</span><span class="w"> </span><span class="k">RETURNING</span><span class="w"> </span><span class="k">VALUE</span><span class="p">(</span><span class="nv">rt_result</span><span class="p">)</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">tt_unit</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDINTERFACE</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_DATA_UNIT_PARSER DEFINITION</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_data_unit_parser</span><span class="w"> </span><span class="k">DEFINITION</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PUBLIC SECTION</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INTERFACES</span><span class="w"> </span><span class="nv">lif_unit_parser</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">constructor</span><span class="w"> </span><span class="k">IMPORTING</span><span class="w"> </span><span class="nv">ir_data</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="k">data</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PRIVATE SECTION</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">mr_data</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="k">data</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">mt_unit</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">tt_unit</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">_parse</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"> </span><span class="nv">ir_data</span><span class="w">      </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="k">data</span><span class="w"></span>
<span class="w">                </span><span class="nv">i_path</span><span class="w">       </span><span class="k">TYPE </span><span class="nv">string</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;$&#39;</span><span class="w"></span>
<span class="w">                </span><span class="nv">i_name</span><span class="w">       </span><span class="k">TYPE </span><span class="nv">string</span><span class="w"> </span><span class="nv">OPTIONAL</span><span class="w"></span>
<span class="w">                </span><span class="nv">io_typedescr</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">cl_abap_typedescr</span><span class="w"> </span><span class="nv">OPTIONAL</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_JSON_UNIT_PARSER DEFINITION</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_json_unit_parser</span><span class="w"> </span><span class="k">DEFINITION</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PUBLIC SECTION</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INTERFACES</span><span class="w"> </span><span class="nv">lif_unit_parser</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">constructor</span><span class="w"> </span><span class="k">IMPORTING</span><span class="w"> </span><span class="nv">i_json</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PRIVATE SECTION</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">m_json</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_XML_UNIT_PARSER DEFINITION</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_xml_unit_parser</span><span class="w"> </span><span class="k">DEFINITION</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PUBLIC SECTION</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INTERFACES</span><span class="w"> </span><span class="nv">lif_unit_parser</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">constructor</span><span class="w"> </span><span class="k">IMPORTING</span><span class="w"> </span><span class="nv">i_xml</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">xstring</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PRIVATE SECTION</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">m_xml</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">xstring</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">mt_unit</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">tt_unit</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_UNIT_HELPER DEFINITION</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_unit_helper</span><span class="w"> </span><span class="k">DEFINITION</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PUBLIC SECTION</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CLASS-METHODS</span><span class="w"> </span><span class="nv">parse_data</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"> </span><span class="nv">ir_data</span><span class="w">          </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="k">data</span><span class="w"></span>
<span class="w">      </span><span class="k">RETURNING</span><span class="w"> </span><span class="k">VALUE</span><span class="p">(</span><span class="nv">rt_result</span><span class="p">)</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">tt_unit</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CLASS-METHODS</span><span class="w"> </span><span class="nv">parse_json</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"> </span><span class="nv">i_json</span><span class="w">           </span><span class="k">TYPE </span><span class="nv">string</span><span class="w"></span>
<span class="w">      </span><span class="k">RETURNING</span><span class="w"> </span><span class="k">VALUE</span><span class="p">(</span><span class="nv">rt_result</span><span class="p">)</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">tt_unit</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CLASS-METHODS</span><span class="w"> </span><span class="nv">parse_xml</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"> </span><span class="nv">i_xml</span><span class="w">            </span><span class="k">TYPE </span><span class="nv">xstring</span><span class="w"></span>
<span class="w">      </span><span class="k">RETURNING</span><span class="w"> </span><span class="k">VALUE</span><span class="p">(</span><span class="nv">rt_result</span><span class="p">)</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">tt_unit</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CLASS-METHODS</span><span class="w"> </span><span class="nv">generate_flatdata</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"> </span><span class="nv">it_unit</span><span class="w">        </span><span class="k">TYPE </span><span class="nv">tt_unit</span><span class="w"></span>
<span class="w">                </span><span class="nv">i_compact</span><span class="w">      </span><span class="k">TYPE </span><span class="nv">xfeld</span><span class="w"> </span><span class="nv">OPTIONAL</span><span class="w"></span>
<span class="w">      </span><span class="k">EXPORTING</span><span class="w"> </span><span class="nv">et_flatdt</span><span class="w">      </span><span class="k">TYPE </span><span class="nv">tt_flatdt</span><span class="w"></span>
<span class="w">      </span><span class="k">RETURNING</span><span class="w"> </span><span class="k">VALUE</span><span class="p">(</span><span class="nv">rr_data</span><span class="p">)</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="k">data</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_DATA_UNIT_PARSER IMPLEMENTATION</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_data_unit_parser</span><span class="w"> </span><span class="k">IMPLEMENTATION</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; METHOD CONSTRUCTOR</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">constructor</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="nv">mr_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ir_data</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; METHOD LIF_UNIT_PARSER~PARSE</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_unit_parser~parse</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="nv">_parse</span><span class="p">(</span><span class="w"> </span><span class="nv">mr_data</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="nv">rt_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">mt_unit</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; METHOD _PARSE</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">_parse</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; 简单来说，就是获取数据的每个字段值，并记录对应路径</span>

<span class="w">    </span><span class="c1">&quot; 数据解析相关参数</span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lo_typedescr</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">cl_abap_typedescr</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lo_tabledescr</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">cl_abap_tabledescr</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lo_structdescr</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">cl_abap_structdescr</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lt_component</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">cl_abap_structdescr</span><span class="o">=&gt;</span><span class="nv">component_table</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lr_component</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">cl_abap_structdescr</span><span class="o">=&gt;</span><span class="nv">component</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; 动态参数</span>
<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">STANDARD</span><span class="w"> </span><span class="k">TABLE</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">any</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">any</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="c1">&quot; 动态引用参数</span>
<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_ref&gt;</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="k">data</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; 数据校验</span>
<span class="w">    </span><span class="k">CHECK</span><span class="w"> </span><span class="nv">ir_data</span><span class="w"> </span><span class="ow">IS BOUND</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">io_typedescr</span><span class="w"> </span><span class="ow">IS BOUND</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">lo_typedescr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">io_typedescr</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ELSE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">lo_typedescr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cl_abap_typedescr</span><span class="o">=&gt;</span><span class="nf">describe_by_data_ref</span><span class="p">(</span><span class="w"> </span><span class="nv">ir_data</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; 路径处理</span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_pathname</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">i_name</span><span class="w"> </span><span class="ow">IS INITIAL</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">l_pathname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">i_path</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ELSE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">l_pathname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">|{</span><span class="w"> </span><span class="nv">i_path</span><span class="w"> </span><span class="p">}</span><span class="s1">.</span><span class="p">{</span><span class="w"> </span><span class="nv">i_name</span><span class="w"> </span><span class="p">}|.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; 主要处理表、结构、数据元素、引用四种类型</span>
<span class="w">    </span><span class="c1">&quot; 类和接口无需处理</span>
<span class="w">    </span><span class="k">CASE</span><span class="w"> </span><span class="nv">lo_typedescr</span><span class="o">-&gt;</span><span class="nv">kind</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="nv">cl_abap_typedescr</span><span class="o">=&gt;</span><span class="nv">kind_table</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 表格类型</span>
<span class="w">        </span><span class="k">ASSIGN</span><span class="w"> </span><span class="nv">ir_data-&gt;*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">lo_tabledescr</span><span class="w"> </span><span class="o">?=</span><span class="w"> </span><span class="nv">lo_typedescr</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">lo_typedescr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lo_tabledescr</span><span class="o">-&gt;</span><span class="nf">get_table_line_type</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"> </span><span class="c1">&quot; 表行类型</span>
<span class="w">        </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_tabix</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">sy</span><span class="o">-</span><span class="nv">tabix</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 所在行</span>
<span class="w">        </span><span class="k">IF</span><span class="w"> </span><span class="nv">lo_typedescr</span><span class="o">-&gt;</span><span class="nv">kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cl_abap_typedescr</span><span class="o">=&gt;</span><span class="nv">kind_ref</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">LOOP</span><span class="w"> </span><span class="k">AT</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="w"> </span><span class="k">ASSIGNING</span><span class="w"> </span><span class="nv">&lt;fs_ref&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="nv">l_tabix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">tabix</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="nv">_parse</span><span class="p">(</span><span class="w"> </span><span class="c1">&quot; 引用类型直接迭代</span>
<span class="w">                </span><span class="nv">ir_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">&lt;fs_ref&gt;</span><span class="w"></span>
<span class="w">                </span><span class="nv">i_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">|{</span><span class="w"> </span><span class="nv">l_pathname</span><span class="w"> </span><span class="p">}</span><span class="s1">[</span><span class="p">{</span><span class="w"> </span><span class="nv">l_tabix</span><span class="w"> </span><span class="p">}</span><span class="s1">]</span><span class="p">|</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">          </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ELSE</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 非引用类型继续分析表行类型</span>
<span class="w">          </span><span class="nv">lo_structdescr</span><span class="w"> </span><span class="o">?=</span><span class="w"> </span><span class="nv">lo_typedescr</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">lt_component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lo_structdescr</span><span class="o">-&gt;</span><span class="nf">get_components</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">          </span><span class="nv">LOOP</span><span class="w"> </span><span class="k">AT</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="w"> </span><span class="k">ASSIGNING</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="nv">l_tabix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">tabix</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="k">LOOP AT </span><span class="nv">lt_component</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="nv">lr_component</span><span class="p">.</span><span class="w"></span>
<span class="w">              </span><span class="k">ASSIGN</span><span class="w"> </span><span class="k">COMPONENT</span><span class="w"> </span><span class="nv">lr_component</span><span class="o">-&gt;</span><span class="nv">name</span><span class="w"> </span><span class="k">OF STRUCTURE</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">              </span><span class="k">IF</span><span class="w"> </span><span class="nv">lr_component</span><span class="o">-&gt;</span><span class="nv">type</span><span class="w"> </span><span class="ow">IS BOUND</span><span class="p">.</span><span class="w"></span>
<span class="w">                </span><span class="nv">_parse</span><span class="p">(</span><span class="w"> </span><span class="c1">&quot; 如果行结构字段也是引用类型，继续迭代</span>
<span class="w">                    </span><span class="nv">ir_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">REF</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">                    </span><span class="nv">i_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">|{</span><span class="w"> </span><span class="nv">l_pathname</span><span class="w"> </span><span class="p">}</span><span class="s1">[</span><span class="p">{</span><span class="w"> </span><span class="nv">l_tabix</span><span class="w"> </span><span class="p">}</span><span class="s1">]</span><span class="p">|</span><span class="w"></span>
<span class="w">                    </span><span class="nv">i_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_component</span><span class="o">-&gt;</span><span class="nv">name</span><span class="w"></span>
<span class="w">                    </span><span class="nv">io_typedescr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_component</span><span class="o">-&gt;</span><span class="nv">type</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">              </span><span class="k">ELSEIF</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="w"> </span><span class="ow">IS ASSIGNED</span><span class="p">.</span><span class="w"></span>
<span class="w">                </span><span class="k">INSERT</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"></span>
<span class="w">                  </span><span class="nv">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">|{</span><span class="w"> </span><span class="nv">l_pathname</span><span class="w"> </span><span class="p">}</span><span class="s1">[</span><span class="p">{</span><span class="w"> </span><span class="nv">l_tabix</span><span class="w"> </span><span class="p">}</span><span class="s1">]</span><span class="p">|</span><span class="w"></span>
<span class="w">                  </span><span class="k">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_component</span><span class="o">-&gt;</span><span class="nv">name</span><span class="w"></span>
<span class="w">                  </span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="w"></span>
<span class="w">                </span><span class="p">)</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">mt_unit</span><span class="p">.</span><span class="w"></span>
<span class="w">              </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="nv">cl_abap_typedescr</span><span class="o">=&gt;</span><span class="nv">kind_struct</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 结构类型</span>
<span class="w">        </span><span class="k">ASSIGN</span><span class="w"> </span><span class="nv">ir_data-&gt;*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">lo_structdescr</span><span class="w"> </span><span class="o">?=</span><span class="w"> </span><span class="nv">lo_typedescr</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">lt_component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lo_structdescr</span><span class="o">-&gt;</span><span class="nf">get_components</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">        </span><span class="k">LOOP AT </span><span class="nv">lt_component</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="nv">lr_component</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">IF</span><span class="w"> </span><span class="nv">lr_component</span><span class="o">-&gt;</span><span class="nv">type</span><span class="w"> </span><span class="ow">IS BOUND</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 非数据元素类型，继续迭代</span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="nv">lr_component</span><span class="o">-&gt;</span><span class="nv">type</span><span class="o">-&gt;</span><span class="nv">kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cl_abap_typedescr</span><span class="o">=&gt;</span><span class="nv">kind_ref</span><span class="p">.</span><span class="w"></span>
<span class="w">              </span><span class="c1">&quot; 引用类型处理</span>
<span class="w">              </span><span class="k">ASSIGN</span><span class="w"> </span><span class="k">COMPONENT</span><span class="w"> </span><span class="nv">lr_component</span><span class="o">-&gt;</span><span class="nv">name</span><span class="w"> </span><span class="k">OF STRUCTURE</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_ref&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">              </span><span class="nv">_parse</span><span class="p">(</span><span class="w"></span>
<span class="w">                  </span><span class="nv">ir_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">&lt;fs_ref&gt;</span><span class="w"></span>
<span class="w">                  </span><span class="nv">i_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_pathname</span><span class="w"></span>
<span class="w">                  </span><span class="nv">i_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_component</span><span class="o">-&gt;</span><span class="nv">name</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">            </span><span class="k">ELSE</span><span class="p">.</span><span class="w"></span>
<span class="w">              </span><span class="c1">&quot; 非引用类型数据</span>
<span class="w">              </span><span class="k">ASSIGN</span><span class="w"> </span><span class="k">COMPONENT</span><span class="w"> </span><span class="nv">lr_component</span><span class="o">-&gt;</span><span class="nv">name</span><span class="w"> </span><span class="k">OF STRUCTURE</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">              </span><span class="nv">_parse</span><span class="p">(</span><span class="w"></span>
<span class="w">                  </span><span class="nv">ir_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">REF</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">                  </span><span class="nv">i_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_pathname</span><span class="w"></span>
<span class="w">                  </span><span class="nv">i_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_component</span><span class="o">-&gt;</span><span class="nv">name</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">ELSE</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="k">ASSIGN</span><span class="w"> </span><span class="k">COMPONENT</span><span class="w"> </span><span class="nv">lr_component</span><span class="o">-&gt;</span><span class="nv">name</span><span class="w"> </span><span class="k">OF STRUCTURE</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="k">INSERT</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"></span>
<span class="w">              </span><span class="nv">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_pathname</span><span class="w"></span>
<span class="w">              </span><span class="k">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_component</span><span class="o">-&gt;</span><span class="nv">name</span><span class="w"></span>
<span class="w">              </span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="w"></span>
<span class="w">            </span><span class="p">)</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">mt_unit</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="nv">cl_abap_typedescr</span><span class="o">=&gt;</span><span class="nv">kind_elem</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 数据元素类型</span>
<span class="w">        </span><span class="k">ASSIGN</span><span class="w"> </span><span class="nv">ir_data-&gt;*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">INSERT</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"></span>
<span class="w">          </span><span class="nv">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">i_path</span><span class="w"></span>
<span class="w">          </span><span class="k">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">i_name</span><span class="w"></span>
<span class="w">          </span><span class="k">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="w"></span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">mt_unit</span><span class="p">.</span><span class="w"></span>

<span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="nv">cl_abap_typedescr</span><span class="o">=&gt;</span><span class="nv">kind_ref</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 引用类型，继续迭代</span>
<span class="w">        </span><span class="k">ASSIGN</span><span class="w"> </span><span class="nv">ir_data-&gt;*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_ref&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">_parse</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="nv">ir_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">&lt;fs_ref&gt;</span><span class="w"></span>
<span class="w">            </span><span class="nv">i_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">i_path</span><span class="w"></span>
<span class="w">            </span><span class="nv">i_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">i_name</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDCASE</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_JSON_UNIT_PARSER IMPLEMENTATION</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_json_unit_parser</span><span class="w"> </span><span class="k">IMPLEMENTATION</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; METHOD CONSTRUCTOR</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">constructor</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="nv">m_json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">i_json</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; METHOD LIF_UNIT_PARSER~PARSE</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_unit_parser~parse</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lo_parser</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">lif_unit_parser</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">lo_parser</span><span class="w"> </span><span class="o">?=</span><span class="w"> </span><span class="nv">NEW</span><span class="w"> </span><span class="nv">lcl_data_unit_parser</span><span class="p">(</span><span class="w"> </span><span class="p">/</span><span class="nv">ui2</span><span class="p">/</span><span class="nv">cl_json</span><span class="o">=&gt;</span><span class="nf">generate</span><span class="p">(</span><span class="w"> </span><span class="nv">m_json</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="nv">rt_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lo_parser</span><span class="o">-&gt;</span><span class="nf">parse</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_XML_UNIT_PARSER IMPLEMENTATION</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_xml_unit_parser</span><span class="w"> </span><span class="k">IMPLEMENTATION</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; METHOD CONSTRUCTOR</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">constructor</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="nv">m_xml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">i_xml</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; METHOD LIF_UNIT_PARSER~PARSE</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_unit_parser~parse</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lt_path</span><span class="w"> </span><span class="k">TYPE STANDARD TABLE OF</span><span class="w"> </span><span class="nv">string</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_name</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lo_reader</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cl_sxml_string_reader</span><span class="o">=&gt;</span><span class="nf">create</span><span class="p">(</span><span class="w"> </span><span class="nv">m_xml</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lo_node</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lo_reader</span><span class="o">-&gt;</span><span class="nf">read_next_node</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">WHILE</span><span class="w"> </span><span class="nv">lo_reader</span><span class="o">-&gt;</span><span class="nv">node_type</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="nv">if_sxml_node</span><span class="o">=&gt;</span><span class="nv">co_nt_final</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CASE</span><span class="w"> </span><span class="nv">lo_reader</span><span class="o">-&gt;</span><span class="nv">node_type</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="nv">if_sxml_node</span><span class="o">=&gt;</span><span class="nv">co_nt_element_open</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">IF</span><span class="w"> </span><span class="nv">l_name</span><span class="w"> </span><span class="ow">IS NOT INITIAL</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">l_name</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">lt_path</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">l_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">CAST</span><span class="w"> </span><span class="nv">if_sxml_open_element</span><span class="p">(</span><span class="w"> </span><span class="nv">lo_node</span><span class="w"> </span><span class="p">)</span><span class="o">-&gt;</span><span class="nv">qname</span><span class="o">-</span><span class="nv">name</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="nv">if_sxml_node</span><span class="o">=&gt;</span><span class="nv">co_nt_element_close</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">l_name</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">IF</span><span class="w"> </span><span class="nv">lt_path</span><span class="w"> </span><span class="ow">IS NOT INITIAL</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="k">DATA</span><span class="p">(</span><span class="nv">l_tabix</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">lines</span><span class="p">(</span><span class="w"> </span><span class="nv">lt_path</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">            </span><span class="nv">l_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lt_path</span><span class="p">[</span><span class="w"> </span><span class="nv">l_tabix</span><span class="w"> </span><span class="p">].</span><span class="w"></span>
<span class="w">            </span><span class="k">DELETE</span><span class="w"> </span><span class="nv">lt_path</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="nv">l_tabix</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="nv">if_sxml_node</span><span class="o">=&gt;</span><span class="nv">co_nt_value</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_unit</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_unit</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_unit</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">CONCATENATE</span><span class="w"> </span><span class="k">LINES</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="nv">lt_path</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nv">ls_unit</span><span class="o">-</span><span class="nv">path</span><span class="w"> </span><span class="k">SEPARATED BY</span><span class="w"> </span><span class="s1">&#39;.&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">ls_unit</span><span class="o">-</span><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_name</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">ls_unit</span><span class="o">-</span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">CAST</span><span class="w"> </span><span class="nv">if_sxml_value</span><span class="p">(</span><span class="w"> </span><span class="nv">lo_node</span><span class="w"> </span><span class="p">)</span><span class="o">-&gt;</span><span class="nf">get_value</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">          </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_unit</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">mt_unit</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDCASE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">lo_node</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lo_reader</span><span class="o">-&gt;</span><span class="nf">read_next_node</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDWHILE</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="nv">rt_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">mt_unit</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_UNIT_HELPER IMPLEMENTATION</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_unit_helper</span><span class="w"> </span><span class="k">IMPLEMENTATION</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; METHOD PARSE_DATA</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">parse_data</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lo_parser</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">lif_unit_parser</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">lo_parser</span><span class="w"> </span><span class="o">?=</span><span class="w"> </span><span class="nv">NEW</span><span class="w"> </span><span class="nv">lcl_data_unit_parser</span><span class="p">(</span><span class="w"> </span><span class="nv">ir_data</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="nv">rt_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lo_parser</span><span class="o">-&gt;</span><span class="nf">parse</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; METHOD PARSE_JSON</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">parse_json</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lo_parser</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">lif_unit_parser</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">lo_parser</span><span class="w"> </span><span class="o">?=</span><span class="w"> </span><span class="nv">NEW</span><span class="w"> </span><span class="nv">lcl_json_unit_parser</span><span class="p">(</span><span class="w"> </span><span class="nv">i_json</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="nv">rt_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lo_parser</span><span class="o">-&gt;</span><span class="nf">parse</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; METHOD PARSE_XML</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">parse_xml</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lo_parser</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">lif_unit_parser</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">lo_parser</span><span class="w"> </span><span class="o">?=</span><span class="w"> </span><span class="nv">NEW</span><span class="w"> </span><span class="nv">lcl_xml_unit_parser</span><span class="p">(</span><span class="w"> </span><span class="nv">i_xml</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="nv">rt_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lo_parser</span><span class="o">-&gt;</span><span class="nf">parse</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; METHOD GENERATE_FLATDATA</span><span class="w"></span>
<span class="c1">*&amp; 将层级数据分析并生成平面数据</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">generate_flatdata</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">CHECK</span><span class="w"> </span><span class="nv">it_unit</span><span class="w"> </span><span class="ow">IS NOT INITIAL</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; 提取结构</span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lt_flatdt</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">tt_flatdt</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_flatdt</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_flatdt</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lt_unitex</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">tt_unitex</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_unitex</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_unitex</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">LOOP AT </span><span class="nv">it_unit</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_unit</span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_flatdt</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_flatdt</span><span class="o">-</span><span class="nv">struct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_unit</span><span class="o">-&gt;</span><span class="nv">path</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_flatdt</span><span class="o">-</span><span class="nv">field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_unit</span><span class="o">-&gt;</span><span class="nv">key</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">REPLACE ALL OCCURRENCES OF REGEX</span><span class="w"> </span><span class="s1">&#39;\[[0-9]*\]&#39;</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="nv">ls_flatdt</span><span class="o">-</span><span class="nv">struct</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 去除表格索引</span>
<span class="w">      </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_flatdt</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">lt_flatdt</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_unitex</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_unitex</span><span class="o">-</span><span class="nv">struct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_flatdt</span><span class="o">-</span><span class="nv">struct</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_unitex</span><span class="o">-</span><span class="nv">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_unit</span><span class="o">-&gt;</span><span class="nv">path</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_unitex</span><span class="o">-</span><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_unit</span><span class="o">-&gt;</span><span class="nv">key</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_unitex</span><span class="o">-</span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_unit</span><span class="o">-&gt;</span><span class="nv">value</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_unitex</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">lt_unitex</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">SORT</span><span class="w"> </span><span class="nv">lt_flatdt</span><span class="w"> </span><span class="nv">BY</span><span class="w"> </span><span class="nv">struct</span><span class="w"> </span><span class="k">field</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DELETE ADJACENT DUPLICATES FROM</span><span class="w"> </span><span class="nv">lt_flatdt</span><span class="w"> </span><span class="k">COMPARING</span><span class="w"> </span><span class="nv">struct</span><span class="w"> </span><span class="k">field</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; 计算每组结构最大字段数，并设定字段所在位置</span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_count</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">i</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_count_max</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">i</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">LOOP AT </span><span class="nv">lt_flatdt</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_flatdt</span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="nv">l_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_count</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">lr_flatdt</span><span class="o">-&gt;</span><span class="nv">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_count</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">AT END OF</span><span class="w"> </span><span class="nv">struct</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">IF</span><span class="w"> </span><span class="nv">l_count_max</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">l_count</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">l_count_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_count</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">l_count</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDAT</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; 动态数据参数</span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lo_tabledescr</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">cl_abap_tabledescr</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lo_structdescr</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">cl_abap_structdescr</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lt_component</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">cl_abap_structdescr</span><span class="o">=&gt;</span><span class="nv">component_table</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_component</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">cl_abap_structdescr</span><span class="o">=&gt;</span><span class="nv">component</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">STANDARD</span><span class="w"> </span><span class="k">TABLE</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">any</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">any</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_fldk&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">any</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 用于染色</span>

<span class="w">    </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_component</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_component</span><span class="o">-</span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">gs_fieldname</span><span class="o">-</span><span class="nv">fdlk</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_component</span><span class="o">-</span><span class="nv">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cl_abap_elemdescr</span><span class="o">=&gt;</span><span class="nf">get_string</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_component</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">lt_component</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_component</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_component</span><span class="o">-</span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">gs_fieldname</span><span class="o">-</span><span class="nv">path</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_component</span><span class="o">-</span><span class="nv">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cl_abap_elemdescr</span><span class="o">=&gt;</span><span class="nf">get_string</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_component</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">lt_component</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_index</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">i</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DO</span><span class="w"> </span><span class="nv">l_count_max</span><span class="w"> </span><span class="k">TIMES</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">l_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_component</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_component</span><span class="o">-</span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">|{</span><span class="w"> </span><span class="nv">gs_fieldname</span><span class="o">-</span><span class="nv">field</span><span class="w"> </span><span class="p">}{</span><span class="w"> </span><span class="nv">l_index</span><span class="w"> </span><span class="p">}|.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_component</span><span class="o">-</span><span class="nv">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cl_abap_elemdescr</span><span class="o">=&gt;</span><span class="nf">get_string</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"> </span><span class="c1">&quot; 都创建为STRING即可</span>
<span class="w">      </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_component</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">lt_component</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDDO</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="nv">lo_structdescr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cl_abap_structdescr</span><span class="o">=&gt;</span><span class="nf">create</span><span class="p">(</span><span class="w"> </span><span class="nv">lt_component</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="nv">lo_tabledescr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cl_abap_tabledescr</span><span class="o">=&gt;</span><span class="nf">create</span><span class="p">(</span><span class="w"> </span><span class="nv">lo_structdescr</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">CREATE DATA</span><span class="w"> </span><span class="nv">rr_data</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">HANDLE</span><span class="w"> </span><span class="nv">lo_tabledescr</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ASSIGN</span><span class="w"> </span><span class="nv">rr_data-&gt;*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; 紧凑表示与否</span>
<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">i_compact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">abap_true</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="c1">&quot; 紧凑表示按结构进行展示</span>
<span class="w">      </span><span class="k">SORT</span><span class="w"> </span><span class="nv">lt_unitex</span><span class="w"> </span><span class="nv">BY</span><span class="w"> </span><span class="nv">struct</span><span class="w"> </span><span class="nv">path</span><span class="w"> </span><span class="k">key</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ELSE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="c1">&quot; 非紧凑表示按数据顺序进行展示</span>
<span class="w">      </span><span class="k">SORT</span><span class="w"> </span><span class="nv">lt_unitex</span><span class="w"> </span><span class="nv">BY</span><span class="w"> </span><span class="nv">path</span><span class="w"> </span><span class="k">key</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">LOOP AT </span><span class="nv">lt_unitex</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_unitex</span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">AT NEW</span><span class="w"> </span><span class="nv">struct</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 新的结构</span>
<span class="w">        </span><span class="k">INSERT INITIAL LINE INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="w"> </span><span class="k">ASSIGNING</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">UNASSIGN</span><span class="w"> </span><span class="nv">&lt;fs_fldk&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ASSIGN</span><span class="w"> </span><span class="k">COMPONENT</span><span class="w"> </span><span class="nv">gs_fieldname</span><span class="o">-</span><span class="nv">fdlk</span><span class="w"> </span><span class="k">OF STRUCTURE</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_fldk&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">IF</span><span class="w"> </span><span class="nv">&lt;fs_fldk&gt;</span><span class="w"> </span><span class="ow">IS ASSIGNED</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">&lt;fs_fldk&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">gs_fdlk</span><span class="o">-</span><span class="nv">header</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">UNASSIGN</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ASSIGN</span><span class="w"> </span><span class="k">COMPONENT</span><span class="w"> </span><span class="nv">gs_fieldname</span><span class="o">-</span><span class="nv">path</span><span class="w"> </span><span class="k">OF STRUCTURE</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">IF</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="w"> </span><span class="ow">IS ASSIGNED</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">&lt;fs_field&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_unitex</span><span class="o">-&gt;</span><span class="nv">struct</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">READ</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">lt_flatdt</span><span class="w"> </span><span class="k">TRANSPORTING NO FIELDS</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="nv">struct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_unitex</span><span class="o">-&gt;</span><span class="nv">struct</span><span class="w"> </span><span class="nv">BINARY</span><span class="w"> </span><span class="k">SEARCH</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">IF</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">subrc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">LOOP AT </span><span class="nv">lt_flatdt</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="nv">lr_flatdt</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">tabix</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="nv">lr_flatdt</span><span class="o">-&gt;</span><span class="nv">struct</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="nv">lr_unitex</span><span class="o">-&gt;</span><span class="nv">struct</span><span class="p">.</span><span class="w"></span>
<span class="w">              </span><span class="k">EXIT</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="nv">UNASSIGN</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="k">ASSIGN</span><span class="w"> </span><span class="k">COMPONENT</span><span class="w"> </span><span class="p">|{</span><span class="w"> </span><span class="nv">gs_fieldname</span><span class="o">-</span><span class="nv">field</span><span class="w"> </span><span class="p">}{</span><span class="w"> </span><span class="nv">lr_flatdt</span><span class="o">-&gt;</span><span class="nv">position</span><span class="w"> </span><span class="p">}|</span><span class="w"> </span><span class="k">OF STRUCTURE</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="k">IF</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="w"> </span><span class="ow">IS ASSIGNED</span><span class="p">.</span><span class="w"></span>
<span class="w">              </span><span class="nv">&lt;fs_field&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_flatdt</span><span class="o">-&gt;</span><span class="nv">field</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDAT</span><span class="p">.</span><span class="w"></span>

<span class="w">      </span><span class="k">AT NEW</span><span class="w"> </span><span class="nv">path</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 新的数据行</span>
<span class="w">        </span><span class="k">INSERT INITIAL LINE INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="w"> </span><span class="k">ASSIGNING</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">UNASSIGN</span><span class="w"> </span><span class="nv">&lt;fs_fldk&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ASSIGN</span><span class="w"> </span><span class="k">COMPONENT</span><span class="w"> </span><span class="nv">gs_fieldname</span><span class="o">-</span><span class="nv">fdlk</span><span class="w"> </span><span class="k">OF STRUCTURE</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_fldk&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">IF</span><span class="w"> </span><span class="nv">&lt;fs_fldk&gt;</span><span class="w"> </span><span class="ow">IS ASSIGNED</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">&lt;fs_fldk&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">gs_fdlk</span><span class="o">-</span><span class="nv">data</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ASSIGN</span><span class="w"> </span><span class="k">COMPONENT</span><span class="w"> </span><span class="nv">gs_fieldname</span><span class="o">-</span><span class="nv">path</span><span class="w"> </span><span class="k">OF STRUCTURE</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">IF</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="w"> </span><span class="ow">IS ASSIGNED</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">&lt;fs_field&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_unitex</span><span class="o">-&gt;</span><span class="nv">path</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">l_index</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDAT</span><span class="p">.</span><span class="w"></span>

<span class="w">      </span><span class="c1">&quot; 填充数据</span>
<span class="w">      </span><span class="k">READ</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">lt_flatdt</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="nv">lr_flatdt</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">KEY</span><span class="w"></span>
<span class="w">      </span><span class="nv">struct</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_unitex</span><span class="o">-&gt;</span><span class="nv">struct</span><span class="w"></span>
<span class="w">      </span><span class="k">field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_unitex</span><span class="o">-&gt;</span><span class="nv">key</span><span class="w"></span>
<span class="w">      </span><span class="nv">BINARY</span><span class="w"> </span><span class="k">SEARCH</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">subrc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">UNASSIGN</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ASSIGN</span><span class="w"> </span><span class="k">COMPONENT</span><span class="w"> </span><span class="p">|{</span><span class="w"> </span><span class="nv">gs_fieldname</span><span class="o">-</span><span class="nv">field</span><span class="w"> </span><span class="p">}{</span><span class="w"> </span><span class="nv">lr_flatdt</span><span class="o">-&gt;</span><span class="nv">position</span><span class="w"> </span><span class="p">}|</span><span class="w"> </span><span class="k">OF STRUCTURE</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">IF</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="w"> </span><span class="ow">IS ASSIGNED</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">&lt;fs_field&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_unitex</span><span class="o">-&gt;</span><span class="nv">value</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">et_flatdt</span><span class="w"> </span><span class="nv">IS</span><span class="w"> </span><span class="nv">SUPPLIED</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">et_flatdt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lt_flatdt</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LIF_ALV</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">INTERFACE</span><span class="w"> </span><span class="nv">lif_alv</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">pai</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">pbo</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">get_selected_uuid</span><span class="w"></span>
<span class="w">    </span><span class="k">EXPORTING</span><span class="w"> </span><span class="nv">et_uuid</span><span class="w">     </span><span class="k">TYPE </span><span class="nv">tt_uuid</span><span class="w"></span>
<span class="w">              </span><span class="nv">et_uuid_opt</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">tt_uuid_opt</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 获取选择行的日志ID</span>
<span class="k">ENDINTERFACE</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_ALV_LOGH</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_alv_logh</span><span class="w"> </span><span class="k">DEFINITION</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PUBLIC SECTION</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INTERFACES</span><span class="w"> </span><span class="nv">lif_alv</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ms_layout</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_s_layo</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">mt_fieldcat</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_t_fcat</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">mt_sort</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_t_sort</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">set_layout</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CLASS-METHODS</span><span class="w"> </span><span class="nv">set_fieldcat</span><span class="w"> </span><span class="k">CHANGING</span><span class="w"> </span><span class="nv">ct_fieldcat</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_t_fcat</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">set_sort</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">set_event</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">set_color</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">on_double_click</span><span class="w"> </span><span class="k">FOR EVENT</span><span class="w"> </span><span class="nv">double_click</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="nv">cl_gui_alv_grid</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"></span>
<span class="w">        </span><span class="nv">e_row</span><span class="w"></span>
<span class="w">        </span><span class="nv">e_column</span><span class="w"></span>
<span class="w">        </span><span class="nv">es_row_no</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CLASS-METHODS</span><span class="w"> </span><span class="nv">display_rawdata</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"> </span><span class="nv">i_uuid</span><span class="w">  </span><span class="k">TYPE </span><span class="nv">ty_log_rawdata</span><span class="o">-</span><span class="nv">uuid</span><span class="w"></span>
<span class="w">                </span><span class="nv">i_zitem</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_log_rawdata</span><span class="o">-</span><span class="nv">zitem</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CLASS-METHODS</span><span class="w"> </span><span class="nv">nav_se37</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"> </span><span class="nv">i_funcname</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_log_head</span><span class="o">-</span><span class="nv">func_name</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_ALV_UNIT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_alv_logh</span><span class="w"> </span><span class="k">IMPLEMENTATION</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LIF_ALV~PBO</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_alv~pbo</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">go_container</span><span class="w"> </span><span class="ow">IS NOT BOUND</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">go_container</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">NEW</span><span class="w"> </span><span class="nv">cl_gui_custom_container</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;CON_9000&#39;</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">go_grid</span><span class="w"> </span><span class="ow">IS NOT BOUND</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">go_grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">NEW</span><span class="w"> </span><span class="nv">cl_gui_alv_grid</span><span class="p">(</span><span class="w"> </span><span class="nv">go_container</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="nv">set_layout</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="nv">set_fieldcat</span><span class="p">(</span><span class="w"> </span><span class="k">CHANGING</span><span class="w"> </span><span class="nv">ct_fieldcat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">mt_fieldcat</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="nv">set_sort</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="nv">set_event</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="nv">set_color</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_variant</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">disvariant</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_variant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="k">report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">repid</span><span class="w"> </span><span class="nv">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">CALL METHOD</span><span class="w"> </span><span class="nv">go_grid</span><span class="o">-&gt;</span><span class="nv">set_table_for_first_display</span><span class="w"></span>
<span class="w">        </span><span class="k">EXPORTING</span><span class="w"></span>
<span class="w">          </span><span class="nv">is_layout</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="nv">ms_layout</span><span class="w"></span>
<span class="w">          </span><span class="nv">is_variant</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_variant</span><span class="w"></span>
<span class="w">          </span><span class="nv">i_save</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;X&#39;</span><span class="w"></span>
<span class="w">        </span><span class="k">CHANGING</span><span class="w"></span>
<span class="w">          </span><span class="nv">it_outtab</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="nv">gt_log</span><span class="w"></span>
<span class="w">          </span><span class="nv">it_fieldcatalog</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="nv">mt_fieldcat</span><span class="w"></span>
<span class="w">          </span><span class="nv">it_sort</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span><span class="nv">mt_sort</span><span class="w"></span>
<span class="w">        </span><span class="k">EXCEPTIONS</span><span class="w"></span>
<span class="w">          </span><span class="nv">invalid_parameter_combination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">          </span><span class="nv">program_error</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">          </span><span class="nv">too_many_lines</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">          </span><span class="k">OTHERS</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ELSE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CALL METHOD</span><span class="w"> </span><span class="nv">go_grid</span><span class="o">-&gt;</span><span class="nv">refresh_table_display</span><span class="w"></span>
<span class="w">        </span><span class="k">EXPORTING</span><span class="w"></span>
<span class="w">          </span><span class="nv">is_stable</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">CONV</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;XX&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="nv">i_soft_refresh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">abap_true</span><span class="w"></span>
<span class="w">        </span><span class="k">EXCEPTIONS</span><span class="w"></span>
<span class="w">          </span><span class="nv">finished</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">          </span><span class="k">OTHERS</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LIF_ALV~PAI</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_alv~pai</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; SET_LAYOUT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">set_layout</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ms_layout</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ms_layout</span><span class="o">-</span><span class="nv">zebra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">abap_true</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 斑马线</span>
<span class="w">    </span><span class="nv">ms_layout</span><span class="o">-</span><span class="nv">cwidth_opt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">abap_true</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 自动调整ALVL列宽</span>
<span class="w">    </span><span class="nv">ms_layout</span><span class="o">-</span><span class="nv">sel_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 选择模式</span>
<span class="w">    </span><span class="nv">ms_layout</span><span class="o">-</span><span class="nv">ctab_fname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;T_SCOL&#39;</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 单元格颜色设置</span>
<span class="c1">*    MS_LAYOUT-STYLEFNAME = &#39;T_STYL&#39;. &quot; 单元格控制</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; SET_FIELDCAT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">set_fieldcat</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_fieldcat</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_s_fcat</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DEFINE</span><span class="w"> </span><span class="nv">_init_fieldcat</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_fieldcat</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">fieldname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">&amp;1</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">tooltip</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">coltext</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">seltext</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">scrtext_l</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">scrtext_m</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">scrtext_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">&amp;2</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">ref_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">&amp;3</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">ref_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">&amp;4</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_fieldcat</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">ct_fieldcat</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">END-OF-DEFINITION</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="s1">&#39;UUID     &#39;</span><span class="w"> </span><span class="s1">&#39;日志ID&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>
<span class="c1">*    _INIT_FIELDCAT &#39;ZITEM    &#39; &#39;序号&#39; &#39;&#39; &#39;&#39;.</span><span class="w"></span>
<span class="w">    </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="s1">&#39;LOG_KIND &#39;</span><span class="w"> </span><span class="s1">&#39;日志分类&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="s1">&#39;INTF_ID  &#39;</span><span class="w"> </span><span class="s1">&#39;接口标识&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="s1">&#39;FUNC_NAME&#39;</span><span class="w"> </span><span class="s1">&#39;函数名&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="s1">&#39;FUNC_TEXT&#39;</span><span class="w"> </span><span class="s1">&#39;函数描述&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>
<span class="c1">*    _INIT_FIELDCAT &#39;ZTEXT    &#39; &#39;附加信息&#39; &#39;&#39; &#39;&#39;. &quot; 该项目没有</span><span class="w"></span>
<span class="w">    </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="s1">&#39;IO_FLAG  &#39;</span><span class="w"> </span><span class="s1">&#39;接口方向&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="s1">&#39;ZSENDER  &#39;</span><span class="w"> </span><span class="s1">&#39;发送方&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="s1">&#39;ZRECEIVER&#39;</span><span class="w"> </span><span class="s1">&#39;接收方&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="s1">&#39;ZDATE    &#39;</span><span class="w"> </span><span class="s1">&#39;日期&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="s1">&#39;ZTIME    &#39;</span><span class="w"> </span><span class="s1">&#39;时间&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="s1">&#39;ZUSER    &#39;</span><span class="w"> </span><span class="s1">&#39;用户&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="s1">&#39;MTYPE    &#39;</span><span class="w"> </span><span class="s1">&#39;状态&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>
<span class="c1">*    _INIT_FIELDCAT &#39;MSG      &#39; &#39;消息文本&#39; &#39;&#39; &#39;&#39;. &quot; 该项目没有</span><span class="w"></span>
<span class="w">    </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="s1">&#39;ZCONUT   &#39;</span><span class="w"> </span><span class="s1">&#39;条目统计&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="s1">&#39;ZRAW_ICON&#39;</span><span class="w"> </span><span class="s1">&#39;原始数据&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; SET_SORT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">set_sort</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_sort</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_s_sort</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_spos</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_s_sort</span><span class="o">-</span><span class="nv">spos</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_sort</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">l_spos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_spos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_sort</span><span class="o">-</span><span class="nv">spos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_spos</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_sort</span><span class="o">-</span><span class="nv">fieldname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ZDATE&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_sort</span><span class="o">-</span><span class="nv">down</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">abap_true</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_sort</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">mt_sort</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_sort</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">l_spos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_spos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_sort</span><span class="o">-</span><span class="nv">spos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_spos</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_sort</span><span class="o">-</span><span class="nv">fieldname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ZTIME&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_sort</span><span class="o">-</span><span class="nv">down</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">abap_true</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_sort</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">mt_sort</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_sort</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">l_spos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_spos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_sort</span><span class="o">-</span><span class="nv">spos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_spos</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_sort</span><span class="o">-</span><span class="nv">fieldname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;UUID&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_sort</span><span class="o">-</span><span class="nv">up</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">abap_true</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_sort</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">mt_sort</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_sort</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">l_spos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_spos</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_sort</span><span class="o">-</span><span class="nv">spos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_spos</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_sort</span><span class="o">-</span><span class="nv">fieldname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;IO_FLAG&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_sort</span><span class="o">-</span><span class="nv">up</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">abap_true</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_sort</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">mt_sort</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; SET_EVENT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">set_event</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">SET HANDLER</span><span class="w"> </span><span class="nv">on_double_click</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="nv">go_grid</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; SET_COLOR</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">set_color</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_scol</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_s_scol</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">LOOP AT </span><span class="nv">gt_log</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_log</span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">t_scol</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">mtype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;S&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">t_scol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">BASE</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">t_scol</span><span class="w"></span>
<span class="w">          </span><span class="k">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">gs_color</span><span class="o">-</span><span class="nv">green</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="w"> </span><span class="nv">fname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MTYPE&#39;</span><span class="w">  </span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="w"> </span><span class="nv">fname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MSG&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">t_scol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">BASE</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">t_scol</span><span class="w"></span>
<span class="w">          </span><span class="k">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">gs_color</span><span class="o">-</span><span class="nv">red</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="w"> </span><span class="nv">fname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MTYPE&#39;</span><span class="w">  </span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="w"> </span><span class="nv">fname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MSG&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; ON_DOUBLE_CLICK</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">on_double_click</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">READ</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">gt_log</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_log</span><span class="p">)</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="nv">e_row</span><span class="o">-</span><span class="nv">index</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CHECK</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">subrc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">CASE</span><span class="w"> </span><span class="nv">e_column</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;UUID&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lt_uuid_opt</span><span class="w"> </span><span class="k">LIKE RANGE OF</span><span class="w"> </span><span class="nv">gs_selection</span><span class="o">-</span><span class="nv">uuid</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">lt_uuid_opt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="k">sign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;I&#39;</span><span class="w"> </span><span class="nv">option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;EQ&#39;</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">uuid</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">        </span><span class="k">SUBMIT</span><span class="w"> </span><span class="p">(</span><span class="nv">sy</span><span class="o">-</span><span class="nv">repid</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="k">WITH</span><span class="w"> </span><span class="nv">s_uuid</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="nv">lt_uuid_opt</span><span class="w"> </span><span class="c1">&quot; 接口ID</span>
<span class="w">        </span><span class="k">WITH</span><span class="w"> </span><span class="nv">s_date</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="nv">s_date</span><span class="w"> </span><span class="c1">&quot; 日期会默认当天，手工传值</span>
<span class="w">        </span><span class="k">WITH</span><span class="w"> </span><span class="nv">s_time</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="nv">s_time</span><span class="w"> </span><span class="c1">&quot; 日期会默认当天，手工传值</span>
<span class="w">        </span><span class="k">WITH</span><span class="w"> </span><span class="nv">p_logh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"></span>
<span class="w">        </span><span class="k">WITH</span><span class="w"> </span><span class="nv">p_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"></span>
<span class="w">        </span><span class="k">WITH</span><span class="w"> </span><span class="nv">p_flat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;X&#39;</span><span class="w"></span>
<span class="w">        </span><span class="k">AND RETURN</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;ZRAW_ICON&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">display_rawdata</span><span class="p">(</span><span class="w"> </span><span class="nv">i_uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">uuid</span><span class="w"></span>
<span class="w">                         </span><span class="nv">i_zitem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">zitem</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;FUNC_NAME&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">nav_se37</span><span class="p">(</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">func_name</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDCASE</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; DISPLAY_RAWDATA</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">display_rawdata</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_html</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">xstring</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">READ</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">gt_log_rawdata</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_log_rawdata</span><span class="p">)</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">KEY</span><span class="w"></span>
<span class="w">    </span><span class="nv">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">i_uuid</span><span class="w"></span>
<span class="w">    </span><span class="nv">zitem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">i_zitem</span><span class="w"></span>
<span class="w">    </span><span class="nv">BINARY</span><span class="w"> </span><span class="k">SEARCH</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">subrc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CASE</span><span class="w"> </span><span class="nv">lr_log_rawdata</span><span class="o">-&gt;</span><span class="nv">zformat</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;JSON&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="c1">&quot; cl_demo_output=&gt;display_json( lr_log_rawdata-&gt;zraw ).</span>
<span class="w">          </span><span class="k">CALL TRANSFORMATION</span><span class="w"> </span><span class="nv">sjson2html</span><span class="w"> </span><span class="k">SOURCE XML</span><span class="w"> </span><span class="nv">lr_log_rawdata</span><span class="o">-&gt;</span><span class="nv">zraw</span><span class="w"> </span><span class="k">RESULT XML</span><span class="w"> </span><span class="nv">l_html</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">cl_abap_browser</span><span class="o">=&gt;</span><span class="nf">show_html</span><span class="p">(</span><span class="w"> </span><span class="nv">html_string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cl_abap_codepage</span><span class="o">=&gt;</span><span class="nf">convert_from</span><span class="p">(</span><span class="w"> </span><span class="nv">l_html</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;XML&#39;</span><span class="p">.</span><span class="w"></span>
<span class="c1">*          cl_demo_output=&gt;display_xml( lr_log_rawdata-&gt;zrawx ).</span><span class="w"></span>
<span class="w">          </span><span class="nv">cl_abap_browser</span><span class="o">=&gt;</span><span class="nf">show_xml</span><span class="p">(</span><span class="w"> </span><span class="nv">xml_xstring</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_log_rawdata</span><span class="o">-&gt;</span><span class="nv">zrawx</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="k">OTHERS</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">cl_demo_output</span><span class="o">=&gt;</span><span class="nf">display</span><span class="p">(</span><span class="w"> </span><span class="nv">lr_log_rawdata</span><span class="o">-&gt;</span><span class="nv">zraw</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDCASE</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; NAV_SE37</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">nav_se37</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_tfdir</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">tfdir</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="c1">&quot; 获取函数对应程序</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="k">SINGLE</span><span class="w"> </span><span class="nv">pname</span><span class="w"> </span><span class="k">include</span><span class="w"></span>
<span class="w">      </span><span class="k">INTO</span><span class="w"> </span><span class="k">CORRESPONDING FIELDS OF</span><span class="w"> </span><span class="nv">ls_tfdir</span><span class="w"></span>
<span class="w">      </span><span class="k">FROM</span><span class="w"> </span><span class="nv">tfdir</span><span class="w"></span>
<span class="w">      </span><span class="k">WHERE</span><span class="w"> </span><span class="nv">funcname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">i_funcname</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="c1">&quot; 设置函数全局信息</span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_rs38l</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">rs38l</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CALL FUNCTION</span><span class="w"> </span><span class="s1">&#39;FUNCTION_INCLUDE_SPLIT&#39;</span><span class="w"></span>
<span class="w">      </span><span class="k">EXPORTING</span><span class="w"></span>
<span class="w">        </span><span class="k">program</span><span class="w">                      </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_tfdir</span><span class="o">-</span><span class="nv">pname</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"></span>
<span class="w">        </span><span class="nv">group</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_rs38l</span><span class="o">-</span><span class="nv">area</span><span class="w"></span>
<span class="w">        </span><span class="nv">namespace</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_rs38l</span><span class="o">-</span><span class="nv">namespace</span><span class="w"></span>
<span class="w">      </span><span class="k">EXCEPTIONS</span><span class="w"></span>
<span class="w">        </span><span class="nv">include_not_exists</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="nv">group_not_exists</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">        </span><span class="nv">no_selections</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">        </span><span class="nv">no_function_include</span><span class="w">          </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"></span>
<span class="w">        </span><span class="nv">no_function_pool</span><span class="w">             </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"></span>
<span class="w">        </span><span class="nv">delimiter_wrong_position</span><span class="w">     </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="w"></span>
<span class="w">        </span><span class="nv">no_customer_function_group</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="mi">7</span><span class="w"></span>
<span class="w">        </span><span class="nv">no_customer_function_include</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8</span><span class="w"></span>
<span class="w">        </span><span class="nv">reserved_name_customer</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="w"></span>
<span class="w">        </span><span class="nv">namespace_too_long</span><span class="w">           </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="w"></span>
<span class="w">        </span><span class="nv">area_length_error</span><span class="w">            </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="w"></span>
<span class="w">        </span><span class="k">OTHERS</span><span class="w">                       </span><span class="o">=</span><span class="w"> </span><span class="mi">12</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CONCATENATE</span><span class="w"> </span><span class="s1">&#39;L&#39;</span><span class="w"> </span><span class="nv">ls_rs38l</span><span class="o">-</span><span class="nv">area</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="w"> </span><span class="nv">ls_tfdir</span><span class="o">-</span><span class="nv">include</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nv">ls_tfdir</span><span class="o">-</span><span class="nv">pname</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CALL FUNCTION</span><span class="w"> </span><span class="s1">&#39;EDITOR_PROGRAM&#39;</span><span class="w"></span>
<span class="w">      </span><span class="k">EXPORTING</span><span class="w"></span>
<span class="w">        </span><span class="nv">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;X&#39;</span><span class="w"></span>
<span class="w">        </span><span class="k">program</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_tfdir</span><span class="o">-</span><span class="nv">pname</span><span class="w"></span>
<span class="w">      </span><span class="k">EXCEPTIONS</span><span class="w"></span>
<span class="w">        </span><span class="k">OTHERS</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LIF_ALV~GET_SELECTED_UUID</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_alv~get_selected_uuid</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; 获取ALV选取行</span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lt_rows</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_t_row</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CALL METHOD</span><span class="w"> </span><span class="nv">go_grid</span><span class="o">-&gt;</span><span class="nv">get_selected_rows</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"></span>
<span class="w">        </span><span class="nv">et_index_rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lt_rows</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">LOOP AT </span><span class="nv">lt_rows</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">ls_row</span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">READ</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">gt_log</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_log</span><span class="p">)</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="nv">ls_row</span><span class="o">-</span><span class="nv">index</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CHECK</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">subrc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">et_uuid</span><span class="w"> </span><span class="nv">IS</span><span class="w"> </span><span class="nv">SUPPLIED</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">APPEND</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">uuid</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">et_uuid</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">et_uuid_opt</span><span class="w"> </span><span class="nv">IS</span><span class="w"> </span><span class="nv">SUPPLIED</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">INSERT</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="k">sign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;I&#39;</span><span class="w"> </span><span class="nv">option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;EQ&#39;</span><span class="w"> </span><span class="nv">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">uuid</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">et_uuid_opt</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">SORT</span><span class="w"> </span><span class="nv">et_uuid</span><span class="w"> </span><span class="nv">BY</span><span class="w"> </span><span class="nv">table_line</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DELETE ADJACENT DUPLICATES FROM</span><span class="w"> </span><span class="nv">et_uuid</span><span class="w"> </span><span class="k">COMPARING</span><span class="w"> </span><span class="nv">table_line</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DELETE</span><span class="w"> </span><span class="nv">et_uuid</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nv">table_line</span><span class="w"> </span><span class="ow">IS INITIAL</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">SORT</span><span class="w"> </span><span class="nv">et_uuid_opt</span><span class="w"> </span><span class="nv">BY</span><span class="w"> </span><span class="nv">low</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DELETE ADJACENT DUPLICATES FROM</span><span class="w"> </span><span class="nv">et_uuid_opt</span><span class="w"> </span><span class="k">COMPARING</span><span class="w"> </span><span class="nv">low</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DELETE</span><span class="w"> </span><span class="nv">et_uuid_opt</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nv">low</span><span class="w"> </span><span class="ow">IS INITIAL</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_ALV_UNIT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_alv_unit</span><span class="w"> </span><span class="k">DEFINITION</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PUBLIC SECTION</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INTERFACES</span><span class="w"> </span><span class="nv">lif_alv</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">TYPES</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="k">BEGIN OF</span><span class="w"> </span><span class="nv">ty_data</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">INCLUDE</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_log_head</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">INCLUDE</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_unit</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">TYPES</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="k">END OF</span><span class="w"> </span><span class="nv">ty_data</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">mt_data</span><span class="w"> </span><span class="k">TYPE STANDARD TABLE OF</span><span class="w"> </span><span class="nv">ty_data</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="nv">EMPTY</span><span class="w"> </span><span class="k">KEY</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ms_layout</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_s_layo</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">mt_fieldcat</span><span class="w"> </span><span class="k">TYPE STANDARD TABLE OF</span><span class="w"> </span><span class="nv">lvc_s_fcat</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">constructor</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">process_data</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">set_layout</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">set_fieldcat</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">set_event</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">set_color</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">on_double_click</span><span class="w"> </span><span class="k">FOR EVENT</span><span class="w"> </span><span class="nv">double_click</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="nv">cl_gui_alv_grid</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"></span>
<span class="w">        </span><span class="nv">e_row</span><span class="w"></span>
<span class="w">        </span><span class="nv">e_column</span><span class="w"></span>
<span class="w">        </span><span class="nv">es_row_no</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_ALV_UNIT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_alv_unit</span><span class="w"> </span><span class="k">IMPLEMENTATION</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; CONSTRUCTOR</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">constructor</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">process_data</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; PROCESS_DATA</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">process_data</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_data</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_data</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lo_progress</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">NEW</span><span class="w"> </span><span class="nv">lcl_progress</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="nv">lo_progress</span><span class="o">-&gt;</span><span class="nv">m_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;转化单元数据&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">lo_progress</span><span class="o">-&gt;</span><span class="nf">start</span><span class="p">(</span><span class="w"> </span><span class="k">lines</span><span class="p">(</span><span class="w"> </span><span class="nv">gt_log</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">LOOP AT </span><span class="nv">gt_log</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_log</span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="nv">lo_progress</span><span class="o">-&gt;</span><span class="nf">next</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_data</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">CORRESPONDING</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">lr_log-&gt;*</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">LOOP AT </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">t_unit</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_unit</span><span class="p">).</span><span class="w"></span>
<span class="w">        </span><span class="k">DATA</span><span class="p">(</span><span class="nv">ls_data_tmp</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_data</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">ls_data_tmp</span><span class="o">-</span><span class="nv">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_unit</span><span class="o">-&gt;</span><span class="nv">path</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">ls_data_tmp</span><span class="o">-</span><span class="nv">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_unit</span><span class="o">-&gt;</span><span class="nv">key</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">ls_data_tmp</span><span class="o">-</span><span class="nv">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_unit</span><span class="o">-&gt;</span><span class="nv">value</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_data_tmp</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">mt_data</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">lo_progress</span><span class="o">-&gt;</span><span class="nf">finish</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LIF_ALV~PBO</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_alv~pbo</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">go_container</span><span class="w"> </span><span class="ow">IS NOT BOUND</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">go_container</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">NEW</span><span class="w"> </span><span class="nv">cl_gui_custom_container</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;CON_9000&#39;</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">go_grid</span><span class="w"> </span><span class="ow">IS NOT BOUND</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">go_grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">NEW</span><span class="w"> </span><span class="nv">cl_gui_alv_grid</span><span class="p">(</span><span class="w"> </span><span class="nv">go_container</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="nv">set_layout</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="nv">set_fieldcat</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="nv">set_event</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="nv">set_color</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_variant</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">disvariant</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_variant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="k">report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">repid</span><span class="w"> </span><span class="nv">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">CALL METHOD</span><span class="w"> </span><span class="nv">go_grid</span><span class="o">-&gt;</span><span class="nv">set_table_for_first_display</span><span class="w"></span>
<span class="w">        </span><span class="k">EXPORTING</span><span class="w"></span>
<span class="w">          </span><span class="nv">is_layout</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="nv">ms_layout</span><span class="w"></span>
<span class="w">          </span><span class="nv">is_variant</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_variant</span><span class="w"></span>
<span class="w">          </span><span class="nv">i_save</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;X&#39;</span><span class="w"></span>
<span class="w">        </span><span class="k">CHANGING</span><span class="w"></span>
<span class="w">          </span><span class="nv">it_outtab</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="nv">mt_data</span><span class="w"></span>
<span class="w">          </span><span class="nv">it_fieldcatalog</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="nv">mt_fieldcat</span><span class="w"></span>
<span class="w">        </span><span class="k">EXCEPTIONS</span><span class="w"></span>
<span class="w">          </span><span class="nv">invalid_parameter_combination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">          </span><span class="nv">program_error</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">          </span><span class="nv">too_many_lines</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">          </span><span class="k">OTHERS</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ELSE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CALL METHOD</span><span class="w"> </span><span class="nv">go_grid</span><span class="o">-&gt;</span><span class="nv">refresh_table_display</span><span class="w"></span>
<span class="w">        </span><span class="k">EXPORTING</span><span class="w"></span>
<span class="w">          </span><span class="nv">is_stable</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">CONV</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;XX&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="nv">i_soft_refresh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">abap_true</span><span class="w"></span>
<span class="w">        </span><span class="k">EXCEPTIONS</span><span class="w"></span>
<span class="w">          </span><span class="nv">finished</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">          </span><span class="k">OTHERS</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LIF_ALV~PAI</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_alv~pai</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; SET_LAYOUT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">set_layout</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ms_layout</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ms_layout</span><span class="o">-</span><span class="nv">zebra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">abap_true</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 斑马线</span>
<span class="w">    </span><span class="nv">ms_layout</span><span class="o">-</span><span class="nv">cwidth_opt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">abap_true</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 自动调整ALVL列宽</span>
<span class="w">    </span><span class="nv">ms_layout</span><span class="o">-</span><span class="nv">sel_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 选择模式</span>
<span class="c1">*    MS_LAYOUT-CTAB_FNAME = &#39;T_SCOL&#39;. &quot; 单元格颜色设置</span><span class="w"></span>
<span class="c1">*    MS_LAYOUT-STYLEFNAME = &#39;T_STYL&#39;. &quot; 单元格控制</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; SET_FIELDCAT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">set_fieldcat</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_fieldcat</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_s_fcat</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DEFINE</span><span class="w"> </span><span class="nv">_init_fieldcat</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_fieldcat</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">fieldname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">&amp;1</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">tooltip</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">coltext</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">seltext</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">scrtext_l</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">scrtext_m</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">scrtext_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">&amp;2</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">ref_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">&amp;3</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">ref_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">&amp;4</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_fieldcat</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">mt_fieldcat</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">END-OF-DEFINITION</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="nv">lcl_alv_logh</span><span class="o">=&gt;</span><span class="nf">set_fieldcat</span><span class="p">(</span><span class="w"> </span><span class="k">CHANGING</span><span class="w"> </span><span class="nv">ct_fieldcat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">mt_fieldcat</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="s1">&#39;PATH&#39;</span><span class="w"> </span><span class="s1">&#39;路径&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="s1">&#39;KEY&#39;</span><span class="w"> </span><span class="s1">&#39;字段名&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="s1">&#39;VALUE&#39;</span><span class="w"> </span><span class="s1">&#39;字段值&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; SET_EVENT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">set_event</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">SET HANDLER</span><span class="w"> </span><span class="nv">on_double_click</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="nv">go_grid</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; SET_COLOR</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">set_color</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_scol</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_s_scol</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">LOOP AT </span><span class="nv">mt_data</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_data</span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">lr_data</span><span class="o">-&gt;</span><span class="nv">t_scol</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">lr_data</span><span class="o">-&gt;</span><span class="nv">mtype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;S&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">lr_data</span><span class="o">-&gt;</span><span class="nv">t_scol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">BASE</span><span class="w"> </span><span class="nv">lr_data</span><span class="o">-&gt;</span><span class="nv">t_scol</span><span class="w"></span>
<span class="w">          </span><span class="k">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">gs_color</span><span class="o">-</span><span class="nv">green</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="w"> </span><span class="nv">fname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MTYPE&#39;</span><span class="w">  </span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="w"> </span><span class="nv">fname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MSG&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">lr_data</span><span class="o">-&gt;</span><span class="nv">t_scol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">BASE</span><span class="w"> </span><span class="nv">lr_data</span><span class="o">-&gt;</span><span class="nv">t_scol</span><span class="w"></span>
<span class="w">          </span><span class="k">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">gs_color</span><span class="o">-</span><span class="nv">red</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="w"> </span><span class="nv">fname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MTYPE&#39;</span><span class="w">  </span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="w"> </span><span class="nv">fname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MSG&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; ON_DOUBLE_CLICK</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">on_double_click</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">READ</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">mt_data</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_data</span><span class="p">)</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="nv">e_row</span><span class="o">-</span><span class="nv">index</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CHECK</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">subrc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CASE</span><span class="w"> </span><span class="nv">e_column</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;ZRAW_ICON&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">lcl_alv_logh</span><span class="o">=&gt;</span><span class="nf">display_rawdata</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="nv">i_uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_data</span><span class="o">-&gt;</span><span class="nv">uuid</span><span class="w"></span>
<span class="w">            </span><span class="nv">i_zitem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_data</span><span class="o">-&gt;</span><span class="nv">zitem</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;FUNC_NAME&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">lcl_alv_logh</span><span class="o">=&gt;</span><span class="nf">nav_se37</span><span class="p">(</span><span class="w"> </span><span class="nv">lr_data</span><span class="o">-&gt;</span><span class="nv">func_name</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDCASE</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LIF_ALV~GET_SELECTED_UUID</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_alv~get_selected_uuid</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; 获取ALV选取行</span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lt_rows</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_t_row</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CALL METHOD</span><span class="w"> </span><span class="nv">go_grid</span><span class="o">-&gt;</span><span class="nv">get_selected_rows</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"></span>
<span class="w">        </span><span class="nv">et_index_rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lt_rows</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">LOOP AT </span><span class="nv">lt_rows</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">ls_row</span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">READ</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">mt_data</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_unit</span><span class="p">)</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="nv">ls_row</span><span class="o">-</span><span class="nv">index</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CHECK</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">subrc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">et_uuid</span><span class="w"> </span><span class="nv">IS</span><span class="w"> </span><span class="nv">SUPPLIED</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">APPEND</span><span class="w"> </span><span class="nv">lr_unit</span><span class="o">-&gt;</span><span class="nv">uuid</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">et_uuid</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">et_uuid_opt</span><span class="w"> </span><span class="nv">IS</span><span class="w"> </span><span class="nv">SUPPLIED</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">INSERT</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="k">sign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;I&#39;</span><span class="w"> </span><span class="nv">option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;EQ&#39;</span><span class="w"> </span><span class="nv">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_unit</span><span class="o">-&gt;</span><span class="nv">uuid</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">et_uuid_opt</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">SORT</span><span class="w"> </span><span class="nv">et_uuid</span><span class="w"> </span><span class="nv">BY</span><span class="w"> </span><span class="nv">table_line</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DELETE ADJACENT DUPLICATES FROM</span><span class="w"> </span><span class="nv">et_uuid</span><span class="w"> </span><span class="k">COMPARING</span><span class="w"> </span><span class="nv">table_line</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DELETE</span><span class="w"> </span><span class="nv">et_uuid</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nv">table_line</span><span class="w"> </span><span class="ow">IS INITIAL</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">SORT</span><span class="w"> </span><span class="nv">et_uuid_opt</span><span class="w"> </span><span class="nv">BY</span><span class="w"> </span><span class="nv">low</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DELETE ADJACENT DUPLICATES FROM</span><span class="w"> </span><span class="nv">et_uuid_opt</span><span class="w"> </span><span class="k">COMPARING</span><span class="w"> </span><span class="nv">low</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DELETE</span><span class="w"> </span><span class="nv">et_uuid_opt</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nv">low</span><span class="w"> </span><span class="ow">IS INITIAL</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_ALV_FLAT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_alv_flat</span><span class="w"> </span><span class="k">DEFINITION</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PUBLIC SECTION</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INTERFACES</span><span class="w"> </span><span class="nv">lif_alv</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">mt_component_flat</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">cl_abap_structdescr</span><span class="o">=&gt;</span><span class="nv">component_table</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">mr_data</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="k">data</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ms_layout</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_s_layo</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">mt_fieldcat</span><span class="w"> </span><span class="k">TYPE STANDARD TABLE OF</span><span class="w"> </span><span class="nv">lvc_s_fcat</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">constructor</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">process_data</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">set_layout</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">set_fieldcat</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">set_event</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">set_color</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">on_double_click</span><span class="w"> </span><span class="k">FOR EVENT</span><span class="w"> </span><span class="nv">double_click</span><span class="w"> </span><span class="k">OF</span><span class="w"> </span><span class="nv">cl_gui_alv_grid</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"></span>
<span class="w">        </span><span class="nv">e_row</span><span class="w"></span>
<span class="w">        </span><span class="nv">e_column</span><span class="w"></span>
<span class="w">        </span><span class="nv">es_row_no</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_ALV_FLAT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_alv_flat</span><span class="w"> </span><span class="k">IMPLEMENTATION</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; CONSTRUCTOR</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">constructor</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">process_data</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; PROCESS_DATA</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">process_data</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; 计算最大字段数量</span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_count_max</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">i</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">LOOP AT </span><span class="nv">gt_log</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_log</span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">LOOP AT </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">t_flatdt</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_flatdt</span><span class="p">).</span><span class="w"></span>
<span class="w">        </span><span class="k">IF</span><span class="w"> </span><span class="nv">l_count_max</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nv">lr_flatdt</span><span class="o">-&gt;</span><span class="nv">position</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">l_count_max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_flatdt</span><span class="o">-&gt;</span><span class="nv">position</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; 抬头部分固定</span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lo_tabledescr</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">cl_abap_tabledescr</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lo_structdescr</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">cl_abap_structdescr</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lt_component</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">cl_abap_structdescr</span><span class="o">=&gt;</span><span class="nv">component_table</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_component</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">cl_abap_structdescr</span><span class="o">=&gt;</span><span class="nv">component</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">lo_structdescr</span><span class="w"> </span><span class="o">?=</span><span class="w"> </span><span class="nv">cl_abap_typedescr</span><span class="o">=&gt;</span><span class="nf">describe_by_data</span><span class="p">(</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="nv">ty_log_head</span><span class="p">(</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="nv">lt_component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lo_structdescr</span><span class="o">-&gt;</span><span class="nf">get_components</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; 扁平部分</span>
<span class="w">    </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_component</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_component</span><span class="o">-</span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">gs_fieldname</span><span class="o">-</span><span class="nv">fdlk</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_component</span><span class="o">-</span><span class="nv">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cl_abap_elemdescr</span><span class="o">=&gt;</span><span class="nf">get_string</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_component</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">mt_component_flat</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_component</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_component</span><span class="o">-</span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">gs_fieldname</span><span class="o">-</span><span class="nv">path</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_component</span><span class="o">-</span><span class="nv">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cl_abap_elemdescr</span><span class="o">=&gt;</span><span class="nf">get_string</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_component</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">mt_component_flat</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_index</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">i</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DO</span><span class="w"> </span><span class="nv">l_count_max</span><span class="w"> </span><span class="k">TIMES</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">l_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_component</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_component</span><span class="o">-</span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">|{</span><span class="w"> </span><span class="nv">gs_fieldname</span><span class="o">-</span><span class="nv">field</span><span class="w"> </span><span class="p">}{</span><span class="w"> </span><span class="nv">l_index</span><span class="w"> </span><span class="p">}|.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_component</span><span class="o">-</span><span class="nv">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cl_abap_elemdescr</span><span class="o">=&gt;</span><span class="nf">get_string</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"> </span><span class="c1">&quot; 都创建为STRING即可</span>
<span class="w">      </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_component</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">mt_component_flat</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDDO</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INSERT LINES OF</span><span class="w"> </span><span class="nv">mt_component_flat</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">lt_component</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; 创建报表展示结构</span>
<span class="w">    </span><span class="nv">lo_structdescr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cl_abap_structdescr</span><span class="o">=&gt;</span><span class="nf">create</span><span class="p">(</span><span class="w"> </span><span class="nv">lt_component</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="nv">lo_tabledescr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">cl_abap_tabledescr</span><span class="o">=&gt;</span><span class="nf">create</span><span class="p">(</span><span class="w"> </span><span class="nv">lo_structdescr</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">CREATE DATA</span><span class="w"> </span><span class="nv">mr_data</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">HANDLE</span><span class="w"> </span><span class="nv">lo_tabledescr</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">STANDARD</span><span class="w"> </span><span class="k">TABLE</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">any</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">any</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ASSIGN</span><span class="w"> </span><span class="nv">mr_data-&gt;*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lo_progress</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">NEW</span><span class="w"> </span><span class="nv">lcl_progress</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="nv">lo_progress</span><span class="o">-&gt;</span><span class="nv">m_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;转化扁平结构&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">lo_progress</span><span class="o">-&gt;</span><span class="nf">start</span><span class="p">(</span><span class="w"> </span><span class="k">lines</span><span class="p">(</span><span class="w"> </span><span class="nv">gt_log</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">).</span><span class="w"></span>

<span class="w">    </span><span class="k">LOOP AT </span><span class="nv">gt_log</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="nv">lr_log</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">lo_progress</span><span class="o">-&gt;</span><span class="nf">next</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>

<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="w"> </span><span class="ow">IS NOT INITIAL</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">DO</span><span class="w"> </span><span class="nv">p_ctl5</span><span class="w"> </span><span class="k">TIMES</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 间隔行，不然太紧凑不好看数据</span>
<span class="w">          </span><span class="k">INSERT INITIAL LINE INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ENDDO</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">r_flatdata</span><span class="w"> </span><span class="ow">IS NOT BOUND</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">INSERT INITIAL LINE INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="w"> </span><span class="k">ASSIGNING</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">CORRESPONDING</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">lr_log-&gt;*</span><span class="w"> </span><span class="p">).</span><span class="w"> </span><span class="c1">&quot; 日志抬头部分</span>
<span class="w">        </span><span class="k">CONTINUE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">      </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_flatdata_table&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">STANDARD</span><span class="w"> </span><span class="k">TABLE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_flatdata_structure&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">any</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_flatdata_field&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">any</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">UNASSIGN</span><span class="w"> </span><span class="nv">&lt;fs_flatdata_table&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">UNASSIGN</span><span class="w"> </span><span class="nv">&lt;fs_flatdata_structure&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ASSIGN</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">r_flatdata-&gt;*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_flatdata_table&gt;</span><span class="p">.</span><span class="w"></span>

<span class="w">      </span><span class="nv">LOOP</span><span class="w"> </span><span class="k">AT</span><span class="w"> </span><span class="nv">&lt;fs_flatdata_table&gt;</span><span class="w"> </span><span class="k">ASSIGNING</span><span class="w"> </span><span class="nv">&lt;fs_flatdata_structure&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">IF</span><span class="w"> </span><span class="nv">p_ctl2</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="nv">abap_true</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 展示抬头</span>
<span class="w">          </span><span class="k">ASSIGN</span><span class="w"> </span><span class="k">COMPONENT</span><span class="w"> </span><span class="nv">gs_fieldname</span><span class="o">-</span><span class="nv">fdlk</span><span class="w"> </span><span class="k">OF STRUCTURE</span><span class="w"> </span><span class="nv">&lt;fs_flatdata_structure&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">FIELD</span><span class="o">-</span><span class="nv">SYMBOL</span><span class="p">(</span><span class="nv">&lt;fs_fdlk&gt;</span><span class="p">).</span><span class="w"></span>
<span class="w">          </span><span class="k">IF</span><span class="w"> </span><span class="nv">&lt;fs_fdlk&gt;</span><span class="w"> </span><span class="ow">IS ASSIGNED</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="k">CHECK</span><span class="w"> </span><span class="nv">&lt;fs_fdlk&gt;</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="nv">gs_fdlk</span><span class="o">-</span><span class="nv">header</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">        </span><span class="k">INSERT INITIAL LINE INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="w"> </span><span class="k">ASSIGNING</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">CORRESPONDING</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">lr_log-&gt;*</span><span class="w"> </span><span class="p">).</span><span class="w"> </span><span class="c1">&quot; 日志抬头部分</span>
<span class="w">        </span><span class="k">LOOP AT </span><span class="nv">mt_component_flat</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nv">ls_component</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">UNASSIGN</span><span class="w"> </span><span class="nv">&lt;fs_flatdata_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">UNASSIGN</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">ASSIGN</span><span class="w"> </span><span class="k">COMPONENT</span><span class="w"> </span><span class="nv">ls_component</span><span class="o">-</span><span class="nv">name</span><span class="w"> </span><span class="k">OF STRUCTURE</span><span class="w"> </span><span class="nv">&lt;fs_flatdata_structure&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_flatdata_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">ASSIGN</span><span class="w"> </span><span class="k">COMPONENT</span><span class="w"> </span><span class="nv">ls_component</span><span class="o">-</span><span class="nv">name</span><span class="w"> </span><span class="k">OF STRUCTURE</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">IF</span><span class="w"> </span><span class="nv">&lt;fs_flatdata_field&gt;</span><span class="w"> </span><span class="ow">IS ASSIGNED</span><span class="w"> </span><span class="ow">AND</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="w"> </span><span class="ow">IS ASSIGNED</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="nv">&lt;fs_field&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">&lt;fs_flatdata_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">lo_progress</span><span class="o">-&gt;</span><span class="nf">finish</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LIF_ALV~PBO</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_alv~pbo</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">go_container</span><span class="w"> </span><span class="ow">IS NOT BOUND</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">go_container</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">NEW</span><span class="w"> </span><span class="nv">cl_gui_custom_container</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;CON_9000&#39;</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">go_grid</span><span class="w"> </span><span class="ow">IS NOT BOUND</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">go_grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">NEW</span><span class="w"> </span><span class="nv">cl_gui_alv_grid</span><span class="p">(</span><span class="w"> </span><span class="nv">go_container</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="nv">set_layout</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="nv">set_fieldcat</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="nv">set_event</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="nv">set_color</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>

<span class="w">      </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">STANDARD</span><span class="w"> </span><span class="k">TABLE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ASSIGN</span><span class="w"> </span><span class="nv">mr_data-&gt;*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="p">.</span><span class="w"></span>

<span class="w">      </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_variant</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">disvariant</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_variant</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="k">report</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">repid</span><span class="w"> </span><span class="nv">handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">CALL METHOD</span><span class="w"> </span><span class="nv">go_grid</span><span class="o">-&gt;</span><span class="nv">set_table_for_first_display</span><span class="w"></span>
<span class="w">        </span><span class="k">EXPORTING</span><span class="w"></span>
<span class="w">          </span><span class="nv">is_layout</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="nv">ms_layout</span><span class="w"></span>
<span class="w">          </span><span class="nv">is_variant</span><span class="w">                    </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_variant</span><span class="w"></span>
<span class="w">          </span><span class="nv">i_save</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;X&#39;</span><span class="w"></span>
<span class="w">        </span><span class="k">CHANGING</span><span class="w"></span>
<span class="w">          </span><span class="nv">it_outtab</span><span class="w">                     </span><span class="o">=</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="w"></span>
<span class="w">          </span><span class="nv">it_fieldcatalog</span><span class="w">               </span><span class="o">=</span><span class="w"> </span><span class="nv">mt_fieldcat</span><span class="w"></span>
<span class="w">        </span><span class="k">EXCEPTIONS</span><span class="w"></span>
<span class="w">          </span><span class="nv">invalid_parameter_combination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">          </span><span class="nv">program_error</span><span class="w">                 </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">          </span><span class="nv">too_many_lines</span><span class="w">                </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"></span>
<span class="w">          </span><span class="k">OTHERS</span><span class="w">                        </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ELSE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CALL METHOD</span><span class="w"> </span><span class="nv">go_grid</span><span class="o">-&gt;</span><span class="nv">refresh_table_display</span><span class="w"></span>
<span class="w">        </span><span class="k">EXPORTING</span><span class="w"></span>
<span class="w">          </span><span class="nv">is_stable</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="nv">CONV</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;XX&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="nv">i_soft_refresh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">abap_true</span><span class="w"></span>
<span class="w">        </span><span class="k">EXCEPTIONS</span><span class="w"></span>
<span class="w">          </span><span class="nv">finished</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">          </span><span class="k">OTHERS</span><span class="w">         </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LIF_ALV~PAI</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_alv~pai</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; SET_LAYOUT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">set_layout</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ms_layout</span><span class="p">.</span><span class="w"></span>
<span class="c1">*    MS_LAYOUT-ZEBRA = ABAP_TRUE. &quot; 斑马线</span><span class="w"></span>
<span class="w">    </span><span class="nv">ms_layout</span><span class="o">-</span><span class="nv">cwidth_opt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">p_ctl4</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; ABAP_TRUE. &quot; 自动调整ALVL列宽</span>
<span class="w">    </span><span class="nv">ms_layout</span><span class="o">-</span><span class="nv">sel_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 选择模式</span>
<span class="w">    </span><span class="nv">ms_layout</span><span class="o">-</span><span class="nv">info_fname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;RCOL&#39;</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 单元格颜色设置</span>
<span class="w">    </span><span class="nv">ms_layout</span><span class="o">-</span><span class="nv">ctab_fname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;T_SCOL&#39;</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 单元格颜色设置</span>
<span class="c1">*    MS_LAYOUT-STYLEFNAME = &#39;T_STYL&#39;. &quot; 单元格控制</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; SET_FIELDCAT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">set_fieldcat</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_fieldcat</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_s_fcat</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DEFINE</span><span class="w"> </span><span class="nv">_init_fieldcat</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_fieldcat</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">fieldname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">&amp;1</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">tooltip</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">coltext</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">seltext</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">scrtext_l</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">scrtext_m</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">scrtext_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">&amp;2</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">ref_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">&amp;3</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_fieldcat</span><span class="o">-</span><span class="nv">ref_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">&amp;4</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_fieldcat</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">mt_fieldcat</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">END-OF-DEFINITION</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="nv">lcl_alv_logh</span><span class="o">=&gt;</span><span class="nf">set_fieldcat</span><span class="p">(</span><span class="w"> </span><span class="k">CHANGING</span><span class="w"> </span><span class="nv">ct_fieldcat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">mt_fieldcat</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="nv">gs_fieldname</span><span class="o">-</span><span class="nv">path</span><span class="w"> </span><span class="s1">&#39;路径&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">LOOP AT </span><span class="nv">mt_component_flat</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">ls_component_flat</span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">ls_component_flat</span><span class="o">-</span><span class="nv">name</span><span class="w"> </span><span class="ow">CS</span><span class="w"> </span><span class="nv">gs_fieldname</span><span class="o">-</span><span class="nv">field</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">_init_fieldcat</span><span class="w"> </span><span class="nv">ls_component_flat</span><span class="o">-</span><span class="nv">name</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; SET_EVENT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">set_event</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">SET HANDLER</span><span class="w"> </span><span class="nv">on_double_click</span><span class="w"> </span><span class="k">FOR</span><span class="w"> </span><span class="nv">go_grid</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; SET_COLOR</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">set_color</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_scol</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_s_scol</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_log_head</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_log_head</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">STANDARD</span><span class="w"> </span><span class="k">TABLE</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">any</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">any</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_t_scol&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_t_scol</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">ASSIGN</span><span class="w"> </span><span class="nv">mr_data-&gt;*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="nv">LOOP</span><span class="w"> </span><span class="k">AT</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="w"> </span><span class="k">ASSIGNING</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="ow">IS INITIAL</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ASSIGN</span><span class="w"> </span><span class="k">COMPONENT</span><span class="w"> </span><span class="s1">&#39;RCOL&#39;</span><span class="w"> </span><span class="k">OF STRUCTURE</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">FIELD</span><span class="o">-</span><span class="nv">SYMBOL</span><span class="p">(</span><span class="nv">&lt;fs_rcol&gt;</span><span class="p">).</span><span class="w"></span>
<span class="w">        </span><span class="k">IF</span><span class="w"> </span><span class="nv">&lt;fs_rcol&gt;</span><span class="w"> </span><span class="ow">IS ASSIGNED</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">&lt;fs_rcol&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;C300&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">CONTINUE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">      </span><span class="k">ASSIGN</span><span class="w"> </span><span class="k">COMPONENT</span><span class="w"> </span><span class="s1">&#39;T_SCOL&#39;</span><span class="w"> </span><span class="k">OF STRUCTURE</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_t_scol&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">&lt;fs_t_scol&gt;</span><span class="p">.</span><span class="w"></span>

<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_log_head</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_log_head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">CORRESPONDING</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">ls_log_head</span><span class="o">-</span><span class="nv">mtype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;S&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">&lt;fs_t_scol&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">BASE</span><span class="w"> </span><span class="nv">&lt;fs_t_scol&gt;</span><span class="w"></span>
<span class="w">          </span><span class="k">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">gs_color</span><span class="o">-</span><span class="nv">green</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="w"> </span><span class="nv">fname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MTYPE&#39;</span><span class="w">  </span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="w"> </span><span class="nv">fname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MSG&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">&lt;fs_t_scol&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">BASE</span><span class="w"> </span><span class="nv">&lt;fs_t_scol&gt;</span><span class="w"></span>
<span class="w">          </span><span class="k">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">gs_color</span><span class="o">-</span><span class="nv">red</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="w"> </span><span class="nv">fname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MTYPE&#39;</span><span class="w">  </span><span class="p">)</span><span class="w"></span>
<span class="w">          </span><span class="p">(</span><span class="w"> </span><span class="nv">fname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MSG&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">      </span><span class="k">CHECK</span><span class="w"> </span><span class="nv">p_ctl3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">abap_true</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 单元格着色</span>
<span class="w">      </span><span class="nv">UNASSIGN</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ASSIGN</span><span class="w"> </span><span class="k">COMPONENT</span><span class="w"> </span><span class="nv">gs_fieldname</span><span class="o">-</span><span class="nv">fdlk</span><span class="w"> </span><span class="k">OF STRUCTURE</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CHECK</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="w"> </span><span class="ow">IS ASSIGNED</span><span class="p">.</span><span class="w"></span>

<span class="w">      </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_color</span><span class="w"> </span><span class="k">LIKE </span><span class="nv">gs_color</span><span class="o">-</span><span class="nv">red</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_color</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CASE</span><span class="w"> </span><span class="nv">&lt;fs_field&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="nv">gs_fdlk</span><span class="o">-</span><span class="nv">header</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">ls_color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">gs_color</span><span class="o">-</span><span class="nv">dept_blue</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="nv">gs_fdlk</span><span class="o">-</span><span class="nv">data</span><span class="p">.</span><span class="w"></span>
<span class="c1">*          LS_COLOR = GS_COLOR-BLUE.</span><span class="w"></span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="k">OTHERS</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">ls_color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">gs_color</span><span class="o">-</span><span class="nv">yellow</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDCASE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">LOOP AT </span><span class="nv">mt_component_flat</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">ls_component</span><span class="p">).</span><span class="w"></span>
<span class="w">        </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_scol</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">ls_scol</span><span class="o">-</span><span class="nv">fname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_component</span><span class="o">-</span><span class="nv">name</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">ls_scol</span><span class="o">-</span><span class="nv">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_color</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_scol</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">&lt;fs_t_scol&gt;</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; ON_DOUBLE_CLICK</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">on_double_click</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">STANDARD</span><span class="w"> </span><span class="k">TABLE</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">any</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ASSIGN</span><span class="w"> </span><span class="nv">mr_data-&gt;*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">READ</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="w"> </span><span class="k">ASSIGNING</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="nv">e_row</span><span class="o">-</span><span class="nv">index</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CHECK</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">subrc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_log_head</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_log_head</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">ls_log_head</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">CORRESPONDING</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="p">).</span><span class="w"></span>

<span class="w">    </span><span class="k">CASE</span><span class="w"> </span><span class="nv">e_column</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;ZRAW_ICON&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">lcl_alv_logh</span><span class="o">=&gt;</span><span class="nf">display_rawdata</span><span class="p">(</span><span class="w"></span>
<span class="w">            </span><span class="nv">i_uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_log_head</span><span class="o">-</span><span class="nv">uuid</span><span class="w"></span>
<span class="w">            </span><span class="nv">i_zitem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_log_head</span><span class="o">-</span><span class="nv">zitem</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;FUNC_NAME&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">lcl_alv_logh</span><span class="o">=&gt;</span><span class="nf">nav_se37</span><span class="p">(</span><span class="w"> </span><span class="nv">ls_log_head</span><span class="o">-</span><span class="nv">func_name</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDCASE</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LIF_ALV~GET_SELECTED_UUID</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_alv~get_selected_uuid</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">STANDARD</span><span class="w"> </span><span class="k">TABLE</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">FIELD-SYMBOLS</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">any</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ASSIGN</span><span class="w"> </span><span class="nv">mr_data-&gt;*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; 获取ALV选取行</span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lt_rows</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">lvc_t_row</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CALL METHOD</span><span class="w"> </span><span class="nv">go_grid</span><span class="o">-&gt;</span><span class="nv">get_selected_rows</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"></span>
<span class="w">        </span><span class="nv">et_index_rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lt_rows</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">LOOP AT </span><span class="nv">lt_rows</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">ls_row</span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">READ</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">&lt;fs_table&gt;</span><span class="w"> </span><span class="k">ASSIGNING</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="nv">ls_row</span><span class="o">-</span><span class="nv">index</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CHECK</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">subrc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ASSIGN</span><span class="w"> </span><span class="k">COMPONENT</span><span class="w"> </span><span class="s1">&#39;UUID&#39;</span><span class="w"> </span><span class="k">OF STRUCTURE</span><span class="w"> </span><span class="nv">&lt;fs_structure&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="k">FIELD</span><span class="o">-</span><span class="nv">SYMBOL</span><span class="p">(</span><span class="nv">&lt;fs_uuid&gt;</span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">et_uuid</span><span class="w"> </span><span class="nv">IS</span><span class="w"> </span><span class="nv">SUPPLIED</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">APPEND</span><span class="w"> </span><span class="nv">&lt;fs_uuid&gt;</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">et_uuid</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">et_uuid_opt</span><span class="w"> </span><span class="nv">IS</span><span class="w"> </span><span class="nv">SUPPLIED</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">INSERT</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="k">sign</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;I&#39;</span><span class="w"> </span><span class="nv">option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;EQ&#39;</span><span class="w"> </span><span class="nv">low</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">&lt;fs_uuid&gt;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">et_uuid_opt</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">SORT</span><span class="w"> </span><span class="nv">et_uuid</span><span class="w"> </span><span class="nv">BY</span><span class="w"> </span><span class="nv">table_line</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DELETE ADJACENT DUPLICATES FROM</span><span class="w"> </span><span class="nv">et_uuid</span><span class="w"> </span><span class="k">COMPARING</span><span class="w"> </span><span class="nv">table_line</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DELETE</span><span class="w"> </span><span class="nv">et_uuid</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nv">table_line</span><span class="w"> </span><span class="ow">IS INITIAL</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">SORT</span><span class="w"> </span><span class="nv">et_uuid_opt</span><span class="w"> </span><span class="nv">BY</span><span class="w"> </span><span class="nv">low</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DELETE ADJACENT DUPLICATES FROM</span><span class="w"> </span><span class="nv">et_uuid_opt</span><span class="w"> </span><span class="k">COMPARING</span><span class="w"> </span><span class="nv">low</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DELETE</span><span class="w"> </span><span class="nv">et_uuid_opt</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nv">low</span><span class="w"> </span><span class="ow">IS INITIAL</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LIF_LOG</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">INTERFACE</span><span class="w"> </span><span class="nv">lif_log</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">check_active</span><span class="w"></span>
<span class="w">    </span><span class="k">RETURNING</span><span class="w"> </span><span class="k">VALUE</span><span class="p">(</span><span class="nv">r_result</span><span class="p">)</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">xfeld</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">get_log_kind</span><span class="w"></span>
<span class="w">    </span><span class="k">RETURNING</span><span class="w"> </span><span class="k">VALUE</span><span class="p">(</span><span class="nv">r_log_kind</span><span class="p">)</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_log_head</span><span class="o">-</span><span class="nv">log_kind</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">get_data</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">METHODS</span><span class="w"> </span><span class="nv">redo</span><span class="w"></span>
<span class="w">    </span><span class="k">IMPORTING</span><span class="w"> </span><span class="nv">it_uuid</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">tt_uuid</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDINTERFACE</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_LOG_PO</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_log_po</span><span class="w"> </span><span class="k">DEFINITION</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PUBLIC SECTION</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INTERFACES</span><span class="w"> </span><span class="nv">lif_log</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_LOG_PO</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_log_po</span><span class="w"> </span><span class="k">IMPLEMENTATION</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; lif_log~get_log_kind</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_log~get_log_kind</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">r_log_kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;PO&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LIF_LOG~GET_DATA</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_log~get_data</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_log</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_log</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_log_rawdata</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_log_rawdata</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_clustkey</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">sxmsclustkey</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_clur</span><span class="w">     </span><span class="k">TYPE </span><span class="nv">sxmsclur</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nv">lt_res</span><span class="w">      </span><span class="k">TYPE </span><span class="nv">sxmsrest</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nv">lt_xres</span><span class="w">     </span><span class="k">TYPE </span><span class="nv">sxmsxrest</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nv">lt_ns</span><span class="w">       </span><span class="k">TYPE </span><span class="nv">sxmsnst</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_from</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">sxmspmast</span><span class="o">-</span><span class="nv">sendtimest</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_to</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">sxmspmast</span><span class="o">-</span><span class="nv">sendtimest</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">s_time[]</span><span class="w"> </span><span class="ow">IS NOT INITIAL</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CONVERT DATE</span><span class="w"> </span><span class="nv">s_date</span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">]</span><span class="o">-</span><span class="nv">low</span><span class="w"> </span><span class="k">TIME</span><span class="w"> </span><span class="nv">s_time</span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">]</span><span class="o">-</span><span class="nv">low</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TIME</span><span class="w"> </span><span class="nv">STAMP</span><span class="w"> </span><span class="nv">l_from</span><span class="w"> </span><span class="k">TIME</span><span class="w"> </span><span class="nv">ZONE</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">zonlo</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CONVERT DATE</span><span class="w"> </span><span class="nv">s_date</span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">]</span><span class="o">-</span><span class="nv">high</span><span class="w"> </span><span class="k">TIME</span><span class="w"> </span><span class="nv">s_time</span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">]</span><span class="o">-</span><span class="nv">high</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TIME</span><span class="w"> </span><span class="nv">STAMP</span><span class="w"> </span><span class="nv">l_to</span><span class="w"> </span><span class="k">TIME</span><span class="w"> </span><span class="nv">ZONE</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">zonlo</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ELSE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CONVERT DATE</span><span class="w"> </span><span class="nv">s_date</span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">]</span><span class="o">-</span><span class="nv">low</span><span class="w"> </span><span class="k">TIME</span><span class="w"> </span><span class="s1">&#39;000000&#39;</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TIME</span><span class="w"> </span><span class="nv">STAMP</span><span class="w"> </span><span class="nv">l_from</span><span class="w"> </span><span class="k">TIME</span><span class="w"> </span><span class="nv">ZONE</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">zonlo</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CONVERT DATE</span><span class="w"> </span><span class="nv">s_date</span><span class="p">[</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">]</span><span class="o">-</span><span class="nv">high</span><span class="w"> </span><span class="k">TIME</span><span class="w"> </span><span class="s1">&#39;235959&#39;</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TIME</span><span class="w"> </span><span class="nv">STAMP</span><span class="w"> </span><span class="nv">l_to</span><span class="w"> </span><span class="k">TIME</span><span class="w"> </span><span class="nv">ZONE</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">zonlo</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; SXMSPEMAS，框架信息，发送SI，接收SI，命名空间，系统等</span>
<span class="w">    </span><span class="c1">&quot; SXMSPMAST，主要信息，用户，开始结束时间等</span>
<span class="w">    </span><span class="c1">&quot; SXMSCLUR，消息报文</span>
<span class="w">    </span><span class="k">SELECT</span><span class="w"></span>
<span class="w">      </span><span class="nv">a~msgguid</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nv">a~pid</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nv">b~ob_system</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nv">b~ob_name</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nv">b~ib_system</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nv">b~ib_name</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nv">a~adminuser</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nv">a~sendtimest</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nv">a~msgtype</span><span class="w"></span>
<span class="w">      </span><span class="k">FROM</span><span class="w"> </span><span class="nv">sxmspmast</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nv">a</span><span class="w"></span>
<span class="w">      </span><span class="k">JOIN</span><span class="w"> </span><span class="nv">sxmspemas</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="nv">b</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="nv">a~msgguid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">b~msgguid</span><span class="w"></span>
<span class="w">                         </span><span class="ow">AND</span><span class="w"> </span><span class="nv">a~pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">b~pid</span><span class="w"></span>
<span class="w">      </span><span class="k">WHERE</span><span class="w"> </span><span class="nv">a~msgguid</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="err">@</span><span class="nv">s_uuid</span><span class="w"></span>
<span class="w">        </span><span class="ow">AND</span><span class="w"> </span><span class="nv">a~sendtimest</span><span class="w"> </span><span class="nv">BETWEEN</span><span class="w"> </span><span class="err">@</span><span class="nv">l_from</span><span class="w"> </span><span class="ow">AND</span><span class="w"> </span><span class="err">@</span><span class="nv">l_to</span><span class="w"></span>
<span class="w">        </span><span class="ow">AND</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nv">b~ob_name</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="err">@</span><span class="nv">s_siname</span><span class="w"> </span><span class="ow">OR</span><span class="w"> </span><span class="nv">b~ib_name</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="err">@</span><span class="nv">s_siname</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="ow">AND</span><span class="w"> </span><span class="nv">a~adminuser</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="err">@</span><span class="nv">s_user</span><span class="w"></span>
<span class="w">        </span><span class="ow">AND</span><span class="w"> </span><span class="nv">a~msgtype</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="err">@</span><span class="nv">s_mtype</span><span class="w"></span>
<span class="w">      </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="err">@</span><span class="nv">DATA</span><span class="p">(</span><span class="nv">lt_pilog</span><span class="p">).</span><span class="w"></span>

<span class="w">    </span><span class="k">LOOP AT </span><span class="nv">lt_pilog</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">ls_pilog</span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="c1">&quot; 读取PO报文</span>
<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_clustkey</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_clur</span><span class="w">    </span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">lt_res</span><span class="w">     </span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">lt_xres</span><span class="w">    </span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">lt_ns</span><span class="w">      </span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_clustkey</span><span class="o">-</span><span class="nv">msgguid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_pilog</span><span class="o">-</span><span class="nv">msgguid</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_clustkey</span><span class="o">-</span><span class="nv">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_pilog</span><span class="o">-</span><span class="nv">pid</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPORT</span><span class="w"></span>
<span class="w">        </span><span class="nv">lt_res</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">lt_res</span><span class="w"></span>
<span class="w">        </span><span class="nv">lt_xres</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">lt_xres</span><span class="w"></span>
<span class="w">        </span><span class="nv">lt_ns</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">lt_ns</span><span class="w"></span>
<span class="w">        </span><span class="k">FROM DATABASE</span><span class="w"> </span><span class="nv">sxmsclur</span><span class="p">(</span><span class="nv">is</span><span class="p">)</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="nv">ls_clur</span><span class="w"> </span><span class="k">ID</span><span class="w"> </span><span class="nv">ls_clustkey</span><span class="p">.</span><span class="w"></span>

<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_log</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_pilog</span><span class="o">-</span><span class="nv">msgguid</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="c1">&quot; 接口ID</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">ls_pilog</span><span class="o">-</span><span class="nv">ob_name</span><span class="w"> </span><span class="ow">IS NOT INITIAL</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">intf_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_pilog</span><span class="o">-</span><span class="nv">ob_name</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">intf_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_pilog</span><span class="o">-</span><span class="nv">ib_name</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">io_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_pilog</span><span class="o">-</span><span class="nv">pid</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 接口方向</span>
<span class="w">      </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">zsender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_pilog</span><span class="o">-</span><span class="nv">ob_system</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 发送方</span>
<span class="w">      </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">zreceiver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_pilog</span><span class="o">-</span><span class="nv">ib_system</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 接受方</span>
<span class="w">      </span><span class="k">CONVERT TIME</span><span class="w"> </span><span class="nv">STAMP</span><span class="w"> </span><span class="nv">ls_pilog</span><span class="o">-</span><span class="nv">sendtimest</span><span class="w"> </span><span class="k">TIME</span><span class="w"> </span><span class="nv">ZONE</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">zonlo</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">DATE</span><span class="w"> </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">zdate</span><span class="w"> </span><span class="k">TIME</span><span class="w"> </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">ztime</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">zuser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_pilog</span><span class="o">-</span><span class="nv">adminuser</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">mtype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_pilog</span><span class="o">-</span><span class="nv">msgtype</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_log</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">gt_log</span><span class="p">.</span><span class="w"></span>

<span class="w">      </span><span class="k">READ</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">lt_xres</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_xres</span><span class="p">)</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">subrc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="ow">AND</span><span class="w"> </span><span class="nv">lr_xres</span><span class="o">-&gt;</span><span class="nv">rescontent</span><span class="w"> </span><span class="ow">IS NOT INITIAL</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_log_rawdata</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">ls_log_rawdata</span><span class="o">-</span><span class="nv">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_pilog</span><span class="o">-</span><span class="nv">msgguid</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">ls_log_rawdata</span><span class="o">-</span><span class="nv">zformat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;XML&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">ls_log_rawdata</span><span class="o">-</span><span class="nv">zrawx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_xres</span><span class="o">-&gt;</span><span class="nv">rescontent</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 原始数据</span>
<span class="w">        </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_log_rawdata</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">gt_log_rawdata</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LIF_LOG~REDO</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_log~redo</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; lif_log~check_active</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_log~check_active</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">r_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">p_po</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_LOG_CUSTOM</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_log_custom</span><span class="w"> </span><span class="k">DEFINITION</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PUBLIC SECTION</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INTERFACES</span><span class="w"> </span><span class="nv">lif_log</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_LOG_CUSTOM</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_log_custom</span><span class="w"> </span><span class="k">IMPLEMENTATION</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; lif_log~get_log_kind</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_log~get_log_kind</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">r_log_kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;CUSTOM&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LIF_LOG~GET_DATA</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_log~get_data</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; DATA ls_log TYPE ty_log.</span>
<span class="w">    </span><span class="c1">&quot; DATA ls_log_rawdata TYPE ty_log_rawdata.</span>
<span class="w">    </span><span class="c1">&quot; DATA l_zitem TYPE ty_log-zitem.</span>

<span class="w">    </span><span class="c1">&quot; SELECT</span>
<span class="w">    </span><span class="c1">&quot;   ztintf~sysid,</span>
<span class="w">    </span><span class="c1">&quot;   ztintf~funcname,</span>
<span class="w">    </span><span class="c1">&quot;   tftit~stext</span>
<span class="w">    </span><span class="c1">&quot;   FROM ztintf</span>
<span class="w">    </span><span class="c1">&quot;   JOIN tftit ON ztintf~funcname = tftit~funcname</span>
<span class="w">    </span><span class="c1">&quot;             AND tftit~spras = &#39;1&#39;</span>
<span class="w">    </span><span class="c1">&quot;   INTO TABLE @DATA(lt_ztintf).</span>
<span class="w">    </span><span class="c1">&quot; SORT lt_ztintf BY sysid.</span>

<span class="w">    </span><span class="c1">&quot; SELECT * FROM ztlog</span>
<span class="w">    </span><span class="c1">&quot; WHERE zguid IN @s_uuid</span>
<span class="w">    </span><span class="c1">&quot;   AND intfid IN @s_intfid</span>
<span class="w">    </span><span class="c1">&quot;   AND zsender IN @s_snd</span>
<span class="w">    </span><span class="c1">&quot;   AND zreceiver IN @s_rcv</span>
<span class="w">    </span><span class="c1">&quot;   AND datum IN @s_date</span>
<span class="w">    </span><span class="c1">&quot;   AND uzeit IN @s_time</span>
<span class="w">    </span><span class="c1">&quot;   AND zstatus IN @s_mtype</span>
<span class="w">    </span><span class="c1">&quot;   AND funcname IN @s_func</span>
<span class="w">    </span><span class="c1">&quot; INTO TABLE @DATA(lt_ztlog).</span>

<span class="w">    </span><span class="c1">&quot; SORT lt_ztlog BY zguid.</span>

<span class="w">    </span><span class="c1">&quot; LOOP AT lt_ztlog INTO DATA(ls_ztlog).</span>
<span class="w">    </span><span class="c1">&quot;   AT NEW zguid.</span>
<span class="w">    </span><span class="c1">&quot;     CLEAR l_zitem.</span>
<span class="w">    </span><span class="c1">&quot;   ENDAT.</span>
<span class="w">    </span><span class="c1">&quot;   l_zitem = l_zitem + 1.</span>

<span class="w">    </span><span class="c1">&quot;   CLEAR ls_log.</span>
<span class="w">    </span><span class="c1">&quot;   ls_log-uuid = ls_ztlog-zguid.</span>
<span class="w">    </span><span class="c1">&quot;   ls_log-zitem = l_zitem.</span>
<span class="w">    </span><span class="c1">&quot;   ls_log-intf_id = ls_ztlog-intfid. &quot; 接口ID</span>
<span class="w">    </span><span class="c1">&quot;   READ TABLE lt_ztintf REFERENCE INTO DATA(lr_ztintf)</span>
<span class="w">    </span><span class="c1">&quot;   WITH KEY sysid = ls_ztlog-intfid BINARY SEARCH.</span>
<span class="w">    </span><span class="c1">&quot;   IF sy-subrc = 0.</span>
<span class="w">    </span><span class="c1">&quot;     ls_log-func_name = lr_ztintf-&gt;funcname.</span>
<span class="w">    </span><span class="c1">&quot;     ls_log-func_text = lr_ztintf-&gt;stext.</span>
<span class="w">    </span><span class="c1">&quot;   ENDIF.</span>
<span class="w">    </span><span class="c1">&quot;   ls_log-io_flag = ls_ztlog-zzio. &quot; 接口方向</span>
<span class="w">    </span><span class="c1">&quot;   ls_log-zsender = ls_ztlog-zsender. &quot; 发送方</span>
<span class="w">    </span><span class="c1">&quot;   ls_log-zreceiver = ls_ztlog-zreceiver. &quot; 接受方</span>
<span class="w">    </span><span class="c1">&quot;   ls_log-zdate = ls_ztlog-datum.</span>
<span class="w">    </span><span class="c1">&quot;   ls_log-ztime = ls_ztlog-uzeit.</span>
<span class="w">    </span><span class="c1">&quot;   ls_log-zuser = ls_ztlog-uname.</span>
<span class="w">    </span><span class="c1">&quot;   ls_log-mtype = ls_ztlog-zstatus.</span>
<span class="w">    </span><span class="c1">&quot;   ls_log-zconut = ls_ztlog-zcount. &quot; 条目统计</span>
<span class="w">    </span><span class="c1">&quot;   INSERT ls_log INTO TABLE gt_log.</span>

<span class="w">    </span><span class="c1">&quot;   IF ls_ztlog-zjson IS NOT INITIAL.</span>
<span class="w">    </span><span class="c1">&quot;     CLEAR ls_log_rawdata.</span>
<span class="w">    </span><span class="c1">&quot;     ls_log_rawdata-uuid = ls_ztlog-zguid.</span>
<span class="w">    </span><span class="c1">&quot;     ls_log_rawdata-zitem = l_zitem.</span>
<span class="w">    </span><span class="c1">&quot;     ls_log_rawdata-zformat = &#39;JSON&#39;.</span>
<span class="w">    </span><span class="c1">&quot;     ls_log_rawdata-zraw = ls_ztlog-zjson. &quot; 原始数据</span>
<span class="w">    </span><span class="c1">&quot;     INSERT ls_log_rawdata INTO TABLE gt_log_rawdata.</span>
<span class="w">    </span><span class="c1">&quot;   ENDIF.</span>
<span class="w">    </span><span class="c1">&quot; ENDLOOP.</span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LIF_LOG~REDO</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_log~redo</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; DATA l_fsyid TYPE string.</span>
<span class="w">    </span><span class="c1">&quot; DATA l_fname TYPE string.</span>
<span class="w">    </span><span class="c1">&quot; DATA l_sdata TYPE string.</span>
<span class="w">    </span><span class="c1">&quot; DATA l_infud TYPE string.</span>
<span class="w">    </span><span class="c1">&quot; DATA l_ftname TYPE string.</span>
<span class="w">    </span><span class="c1">&quot; DATA(lo_proxy) = NEW zcl_intf_proxy( ).</span>

<span class="w">    </span><span class="c1">&quot; LOOP AT it_uuid INTO DATA(l_uuid).</span>
<span class="w">    </span><span class="c1">&quot;   READ TABLE gt_log INTO DATA(ls_log) WITH KEY</span>
<span class="w">    </span><span class="c1">&quot;   uuid = l_uuid</span>
<span class="w">    </span><span class="c1">&quot;   io_flag = &#39;2&#39;.</span>
<span class="w">    </span><span class="c1">&quot;   IF ls_log-mtype = &#39;S&#39;.</span>
<span class="w">    </span><span class="c1">&quot;     lcl_progress=&gt;step( |{ l_uuid }不需要重处理| ).</span>
<span class="w">    </span><span class="c1">&quot;     CONTINUE.</span>
<span class="w">    </span><span class="c1">&quot;   ELSE.</span>
<span class="w">    </span><span class="c1">&quot;     READ TABLE gt_log INTO ls_log WITH KEY</span>
<span class="w">    </span><span class="c1">&quot;     uuid = l_uuid</span>
<span class="w">    </span><span class="c1">&quot;     io_flag = &#39;1&#39;.</span>
<span class="w">    </span><span class="c1">&quot;     IF sy-subrc = 0.</span>
<span class="w">    </span><span class="c1">&quot;       READ TABLE gt_log_rawdata INTO DATA(ls_log_rawdata) WITH KEY</span>
<span class="w">    </span><span class="c1">&quot;       uuid = ls_log-uuid</span>
<span class="w">    </span><span class="c1">&quot;       zitem = ls_log-zitem</span>
<span class="w">    </span><span class="c1">&quot;       BINARY SEARCH.</span>
<span class="w">    </span><span class="c1">&quot;       IF sy-subrc = 0.</span>
<span class="w">    </span><span class="c1">&quot;         l_fsyid = ls_log-zsender. &quot; 外部系统</span>
<span class="w">    </span><span class="c1">&quot;         l_fname = ls_log-intf_id. &quot; 接口ID</span>
<span class="w">    </span><span class="c1">&quot;         l_sdata = ls_log_rawdata-zraw. &quot; 请求报文</span>
<span class="w">    </span><span class="c1">&quot;         l_infud = ls_log-uuid. &quot; 报文ID</span>
<span class="w">    </span><span class="c1">&quot;         l_ftname = ls_log-func_name. &quot; 对应函数名</span>
<span class="w">    </span><span class="c1">&quot;         CASE ls_log-zsender.</span>
<span class="w">    </span><span class="c1">&quot;           WHEN &#39;SAP&#39;.</span>
<span class="w">    </span><span class="c1">&quot;             CALL METHOD lo_proxy-&gt;sap_data_to_out</span>
<span class="w">    </span><span class="c1">&quot;               EXPORTING</span>
<span class="w">    </span><span class="c1">&quot;                 iv_fname  = l_fname</span>
<span class="w">    </span><span class="c1">&quot;                 iv_sdata  = l_sdata</span>
<span class="w">    </span><span class="c1">&quot;                 iv_infud  = l_infud</span>
<span class="w">    </span><span class="c1">&quot;                 iv_ftname = l_ftname.</span>
<span class="w">    </span><span class="c1">&quot;           WHEN OTHERS.</span>
<span class="w">    </span><span class="c1">&quot;             CALL METHOD lo_proxy-&gt;out_data_to_sap</span>
<span class="w">    </span><span class="c1">&quot;               EXPORTING</span>
<span class="w">    </span><span class="c1">&quot;                 iv_fsyid = l_fsyid</span>
<span class="w">    </span><span class="c1">&quot;                 iv_fname = l_fname</span>
<span class="w">    </span><span class="c1">&quot;                 iv_sdata = l_sdata</span>
<span class="w">    </span><span class="c1">&quot;                 iv_infud = l_infud.</span>
<span class="w">    </span><span class="c1">&quot;         ENDCASE.</span>
<span class="w">    </span><span class="c1">&quot;         lcl_progress=&gt;step( |{ l_uuid }已提交重处理| ).</span>
<span class="w">    </span><span class="c1">&quot;       ENDIF.</span>
<span class="w">    </span><span class="c1">&quot;     ENDIF.</span>
<span class="w">    </span><span class="c1">&quot;   ENDIF.</span>
<span class="w">    </span><span class="c1">&quot; ENDLOOP.</span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; lif_log~check_active</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_log~check_active</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">r_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">p_custom</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>

<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; FRM_INIT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">FORM</span><span class="w"> </span><span class="nf">frm_init</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">GET PARAMETER</span><span class="w"> </span><span class="k">ID</span><span class="w"> </span><span class="s1">&#39;LIB&#39;</span><span class="w"> </span><span class="k">FIELD</span><span class="w"> </span><span class="nv">s_func</span><span class="o">-</span><span class="nv">low</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 更新参数相关</span>

<span class="w">  </span><span class="nv">b900</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;自定义选择条件&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_p_custom_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;查询自定义日志&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_s_intfid_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;接口编号&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="nv">b100</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;通用选择条件&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_s_uuid_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;UUID&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_s_func_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;函数名&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_s_snd_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;发送方&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_s_rcv_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;接收方&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_s_date_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;处理日期&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_s_time_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;处理时间&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_s_user_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;处理人&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_s_mtype_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;状态&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="nv">b101</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;扩展选择条件&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_s_field_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;字段名&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_s_value_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;字段值&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="nv">b102</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;PO选择条件&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_p_po_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;查询PO&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_s_siname_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;接口名称&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="nv">b200</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;报表样式&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_p_logh_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;日志抬头数据展示&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_p_unit_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;单元数据展示&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_p_flat_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;扁平结构展示&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="nv">b201</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;其他选项&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_p_ctl1_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;紧凑展示&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_p_ctl2_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;展示结构抬头&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_p_ctl3_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;单元格着色&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_p_ctl4_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;列宽自适应&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="err">%</span><span class="nv">_p_ctl5_</span><span class="err">%</span><span class="nv">_app_</span><span class="err">%</span><span class="o">-</span><span class="nv">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;日志记录相隔空行&#39;</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="nv">gs_color</span><span class="o">-</span><span class="nv">blue</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">  </span><span class="nv">gs_color</span><span class="o">-</span><span class="nv">yellow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">  </span><span class="nv">gs_color</span><span class="o">-</span><span class="nv">green</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">  </span><span class="nv">gs_color</span><span class="o">-</span><span class="nv">red</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">  </span><span class="nv">gs_color</span><span class="o">-</span><span class="nv">dept_blue</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="nv">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">  </span><span class="nv">gs_color</span><span class="o">-</span><span class="nv">dept_yellow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="nv">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">  </span><span class="nv">gs_color</span><span class="o">-</span><span class="nv">dept_green</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="nv">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">  </span><span class="nv">gs_color</span><span class="o">-</span><span class="nv">dept_red</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="k">VALUE</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="nv">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">).</span><span class="w"></span>

<span class="w">  </span><span class="k">PERFORM</span><span class="w"> </span><span class="nf">frm_find_log_impl</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 查找并创建日志实例</span>

<span class="k">ENDFORM</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; FRM_FIND_LOG_IMPL</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">FORM</span><span class="w"> </span><span class="nf">frm_find_log_impl</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lt_classname</span><span class="w"> </span><span class="k">TYPE STANDARD TABLE OF</span><span class="w"> </span><span class="nv">seoclsname</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lo_classdescr</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">cl_abap_classdescr</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lo_log</span><span class="w"> </span><span class="k">TYPE REF TO</span><span class="w"> </span><span class="nv">lif_log</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lo_scan</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">NEW</span><span class="w"> </span><span class="nv">cl_ci_scan</span><span class="p">(</span><span class="w"> </span><span class="nv">cl_ci_source_include</span><span class="o">=&gt;</span><span class="nf">create</span><span class="p">(</span><span class="w"> </span><span class="nv">p_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">repid</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">  </span><span class="k">LOOP AT </span><span class="nv">lo_scan</span><span class="o">-&gt;</span><span class="nv">tokens</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">ls_token</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nv">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;CLASS&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">READ</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">lo_scan</span><span class="o">-&gt;</span><span class="nv">tokens</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nv">ls_token</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">tabix</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">CONV</span><span class="w"> </span><span class="err">#</span><span class="p">(</span><span class="w"> </span><span class="nv">ls_token</span><span class="o">-</span><span class="nv">str</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">lt_classname</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">SORT</span><span class="w"> </span><span class="nv">lt_classname</span><span class="w"> </span><span class="nv">BY</span><span class="w"> </span><span class="nv">table_line</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">DELETE ADJACENT DUPLICATES FROM</span><span class="w"> </span><span class="nv">lt_classname</span><span class="w"> </span><span class="k">COMPARING</span><span class="w"> </span><span class="nv">table_line</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">LOOP AT </span><span class="nv">lt_classname</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">l_classname</span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="nv">lo_classdescr</span><span class="w"> </span><span class="o">?=</span><span class="w"> </span><span class="nv">cl_abap_classdescr</span><span class="o">=&gt;</span><span class="nf">describe_by_name</span><span class="p">(</span><span class="w"> </span><span class="nv">l_classname</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">READ</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">lo_classdescr</span><span class="o">-&gt;</span><span class="nv">interfaces</span><span class="w"> </span><span class="k">TRANSPORTING NO FIELDS</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="nv">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;LIF_LOG&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">subrc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">TRY</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">CREATE OBJECT</span><span class="w"> </span><span class="nv">lo_log</span><span class="w"> </span><span class="nv">TYPE</span><span class="w"> </span><span class="p">(</span><span class="nv">lo_classdescr</span><span class="o">-&gt;</span><span class="nv">absolute_name</span><span class="p">).</span><span class="w"></span>
<span class="w">          </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">lo_log</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">gt_log_impl</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">CATCH</span><span class="w"> </span><span class="nv">cx_root</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDTRY</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="k">ENDFORM</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; FRM_MAIN</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">FORM</span><span class="w"> </span><span class="nf">frm_main</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="c1">&quot; 为了方便读取时间+日期范围，稍微调整下日期格式</span>
<span class="w">  </span><span class="k">LOOP AT </span><span class="nv">s_date</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_date_opt</span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">lr_date_opt</span><span class="o">-&gt;</span><span class="nv">high</span><span class="w"> </span><span class="ow">IS INITIAL</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">lr_date_opt</span><span class="o">-&gt;</span><span class="nv">option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;BT&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">lr_date_opt</span><span class="o">-&gt;</span><span class="nv">high</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_date_opt</span><span class="o">-&gt;</span><span class="nv">low</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">LOOP AT </span><span class="nv">s_time</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_time_opt</span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">lr_time_opt</span><span class="o">-&gt;</span><span class="nv">high</span><span class="w"> </span><span class="ow">IS INITIAL</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">lr_time_opt</span><span class="o">-&gt;</span><span class="nv">option</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;BT&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">lr_time_opt</span><span class="o">-&gt;</span><span class="nv">high</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_time_opt</span><span class="o">-&gt;</span><span class="nv">low</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="nv">lcl_progress</span><span class="o">=&gt;</span><span class="nf">step</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;查询日志数据&#39;</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">  </span><span class="k">PERFORM</span><span class="w"> </span><span class="nf">frm_get_data</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="nv">lcl_progress</span><span class="o">=&gt;</span><span class="nf">step</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;日志数据处理&#39;</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">  </span><span class="k">PERFORM</span><span class="w"> </span><span class="nf">frm_process_data</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">PERFORM</span><span class="w"> </span><span class="nf">frm_display</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; ALV展示</span>

<span class="k">ENDFORM</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; FRM_GET_DATA</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">FORM</span><span class="w"> </span><span class="nf">frm_get_data</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lt_log</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">tt_log</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">LOOP AT </span><span class="nv">gt_log_impl</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lo_log</span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">CHECK</span><span class="w"> </span><span class="nv">lo_log</span><span class="o">-&gt;</span><span class="nf">check_active</span><span class="p">(</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">abap_true</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">gt_log</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">lo_log</span><span class="o">-&gt;</span><span class="nf">get_data</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"> </span><span class="c1">&quot; 取数</span>
<span class="w">    </span><span class="k">LOOP AT </span><span class="nv">gt_log</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_log</span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">log_kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lo_log</span><span class="o">-&gt;</span><span class="nf">get_log_kind</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">zraw_icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">icon_detail</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INSERT LINES OF</span><span class="w"> </span><span class="nv">gt_log</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">lt_log</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="nv">gt_log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lt_log</span><span class="p">.</span><span class="w"></span>

<span class="k">ENDFORM</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; FRM_PROCESS_DATA</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">FORM</span><span class="w"> </span><span class="nf">frm_process_data</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="c1">&quot; 日期时间倒序</span>
<span class="w">  </span><span class="k">SORT</span><span class="w"> </span><span class="nv">gt_log</span><span class="w"> </span><span class="nv">BY</span><span class="w"> </span><span class="nv">zdate</span><span class="w"> </span><span class="nv">DESCENDING</span><span class="w"></span>
<span class="w">                 </span><span class="nv">ztime</span><span class="w"> </span><span class="nv">DESCENDING</span><span class="w"></span>
<span class="w">                 </span><span class="nv">uuid</span><span class="w"></span>
<span class="w">                 </span><span class="nv">zitem</span><span class="w"> </span><span class="nv">DESCENDING</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">SORT</span><span class="w"> </span><span class="nv">gt_log_rawdata</span><span class="w"> </span><span class="nv">BY</span><span class="w"> </span><span class="nv">uuid</span><span class="w"> </span><span class="nv">zitem</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 用于弹窗展示原始数据</span>

<span class="w">  </span><span class="c1">&quot; 不需要展示加工数据的话，没必要继续执行浪费时间</span>
<span class="w">  </span><span class="k">IF</span><span class="w"> </span><span class="nv">p_logh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">abap_true</span><span class="w"> </span><span class="ow">AND</span><span class="w"> </span><span class="nv">s_value[]</span><span class="w"> </span><span class="ow">IS INITIAL</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">RETURN</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="c1">*  &quot; 模糊查询</span><span class="w"></span>
<span class="c1">*  LOOP AT s_value[] REFERENCE INTO DATA(lr_value_opt).</span><span class="w"></span>
<span class="c1">*    IF lr_value_opt-&gt;option = &#39;EQ&#39;.</span><span class="w"></span>
<span class="c1">*      lr_value_opt-&gt;option = &#39;CP&#39;.</span><span class="w"></span>
<span class="c1">*      lr_value_opt-&gt;low = |*{ lr_value_opt-&gt;low }*|.</span><span class="w"></span>
<span class="c1">*    ENDIF.</span><span class="w"></span>
<span class="c1">*  ENDLOOP.</span><span class="w"></span>

<span class="w">  </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lo_progress</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">NEW</span><span class="w"> </span><span class="nv">lcl_progress</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">  </span><span class="nv">lo_progress</span><span class="o">-&gt;</span><span class="nv">m_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;接口数据处理&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="nv">lo_progress</span><span class="o">-&gt;</span><span class="nf">start</span><span class="p">(</span><span class="w"> </span><span class="k">lines</span><span class="p">(</span><span class="w"> </span><span class="nv">gt_log</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">).</span><span class="w"></span>

<span class="w">  </span><span class="k">LOOP AT </span><span class="nv">gt_log</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_log</span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="nv">lo_progress</span><span class="o">-&gt;</span><span class="nf">next</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"> </span><span class="c1">&quot; 进度展示</span>

<span class="w">    </span><span class="c1">&quot; 转化为数据单元</span>
<span class="w">    </span><span class="k">READ</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">gt_log_rawdata</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_log_rawdata</span><span class="p">)</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">KEY</span><span class="w"></span>
<span class="w">    </span><span class="nv">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">uuid</span><span class="w"></span>
<span class="w">    </span><span class="nv">zitem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">zitem</span><span class="w"></span>
<span class="w">    </span><span class="nv">BINARY</span><span class="w"> </span><span class="k">SEARCH</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">subrc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">CASE</span><span class="w"> </span><span class="nv">lr_log_rawdata</span><span class="o">-&gt;</span><span class="nv">zformat</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;JSON&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">t_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lcl_unit_helper</span><span class="o">=&gt;</span><span class="nf">parse_json</span><span class="p">(</span><span class="w"> </span><span class="nv">lr_log_rawdata</span><span class="o">-&gt;</span><span class="nv">zraw</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;XML&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">t_unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lcl_unit_helper</span><span class="o">=&gt;</span><span class="nf">parse_xml</span><span class="p">(</span><span class="w"> </span><span class="nv">lr_log_rawdata</span><span class="o">-&gt;</span><span class="nv">zrawx</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDCASE</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CHECK</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">t_unit</span><span class="w"> </span><span class="ow">IS NOT INITIAL</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="c1">&quot; 扩展查询</span>
<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">s_value[]</span><span class="w"> </span><span class="ow">IS NOT INITIAL</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">s_field[]</span><span class="w"> </span><span class="ow">IS NOT INITIAL</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">LOOP AT </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">t_unit</span><span class="w"> </span><span class="k">TRANSPORTING NO FIELDS</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">key</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="nv">s_field[]</span><span class="w"> </span><span class="ow">AND</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="nv">s_value[]</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">EXIT</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">LOOP AT </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">t_unit</span><span class="w"> </span><span class="k">TRANSPORTING NO FIELDS</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="k">value</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="nv">s_value[]</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">EXIT</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="c1">&quot; 过滤不符合条件的数据</span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">subrc</span><span class="w"> </span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">DELETE</span><span class="w"> </span><span class="nv">gt_log</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">CONTINUE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">CALL METHOD</span><span class="w"> </span><span class="nv">lcl_unit_helper</span><span class="o">=&gt;</span><span class="nv">generate_flatdata</span><span class="w"></span>
<span class="w">      </span><span class="k">EXPORTING</span><span class="w"></span>
<span class="w">        </span><span class="nv">it_unit</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">t_unit</span><span class="w"></span>
<span class="w">        </span><span class="nv">i_compact</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">p_ctl1</span><span class="w"></span>
<span class="w">      </span><span class="k">IMPORTING</span><span class="w"></span>
<span class="w">        </span><span class="nv">et_flatdt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">t_flatdt</span><span class="w"></span>
<span class="w">      </span><span class="nv">RECEIVING</span><span class="w"></span>
<span class="w">        </span><span class="nv">rr_data</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">r_flatdata</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="nv">lo_progress</span><span class="o">-&gt;</span><span class="nf">finish</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>

<span class="k">ENDFORM</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; FRM_DISPLAY</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">FORM</span><span class="w"> </span><span class="nf">frm_display</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">CASE</span><span class="w"> </span><span class="s1">&#39;X&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="nv">p_logh</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 日志抬头数据展示</span>
<span class="w">      </span><span class="nv">go_alv</span><span class="w"> </span><span class="o">?=</span><span class="w"> </span><span class="nv">NEW</span><span class="w"> </span><span class="nv">lcl_alv_logh</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="nv">p_unit</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 单元数据展示</span>
<span class="w">      </span><span class="nv">go_alv</span><span class="w"> </span><span class="o">?=</span><span class="w"> </span><span class="nv">NEW</span><span class="w"> </span><span class="nv">lcl_alv_unit</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="nv">p_flat</span><span class="p">.</span><span class="c1">&quot; 扁平结构展示</span>
<span class="w">      </span><span class="nv">go_alv</span><span class="w"> </span><span class="o">?=</span><span class="w"> </span><span class="nv">NEW</span><span class="w"> </span><span class="nv">lcl_alv_flat</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="k">OTHERS</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">MESSAGE</span><span class="w"> </span><span class="s1">&#39;无效的展示方式&#39;</span><span class="w"> </span><span class="nv">TYPE</span><span class="w"> </span><span class="s1">&#39;S&#39;</span><span class="w"> </span><span class="nv">DISPLAY</span><span class="w"> </span><span class="nv">LIKE</span><span class="w"> </span><span class="s1">&#39;E&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">RETURN</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDCASE</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">CALL SCREEN</span><span class="w"> </span><span class="s1">&#39;9000&#39;</span><span class="p">.</span><span class="w"></span>

<span class="k">ENDFORM</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; FRM_REDO</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">FORM</span><span class="w"> </span><span class="nf">frm_redo</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="nv">go_alv</span><span class="o">-&gt;</span><span class="nf">get_selected_uuid</span><span class="p">(</span><span class="w"> </span><span class="k">IMPORTING</span><span class="w"> </span><span class="nv">et_uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lt_uuid</span><span class="p">)</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">  </span><span class="k">CHECK</span><span class="w"> </span><span class="nv">lt_uuid</span><span class="w"> </span><span class="ow">IS NOT INITIAL</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">LOOP AT </span><span class="nv">gt_log_impl</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lo_log</span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">CHECK</span><span class="w"> </span><span class="nv">lo_log</span><span class="o">-&gt;</span><span class="nf">check_active</span><span class="p">(</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">abap_true</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="p">(</span><span class="nv">l_log_kind</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lo_log</span><span class="o">-&gt;</span><span class="nf">get_log_kind</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">lt_uuid_tmp</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">tt_uuid</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">lt_uuid_tmp</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">LOOP AT </span><span class="nv">gt_log</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_log</span><span class="p">)</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="nv">log_kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_log_kind</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">READ</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">lt_uuid</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">l_uuid</span><span class="p">)</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="nv">table_line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_log</span><span class="o">-&gt;</span><span class="nv">uuid</span><span class="w"> </span><span class="nv">BINARY</span><span class="w"> </span><span class="k">SEARCH</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">subrc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">l_uuid</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">lt_uuid_tmp</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="nv">lt_uuid_tmp</span><span class="w"> </span><span class="ow">IS NOT INITIAL</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">lo_log</span><span class="o">-&gt;</span><span class="nf">redo</span><span class="p">(</span><span class="w"> </span><span class="nv">lt_uuid_tmp</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="k">ENDFORM</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; FRM_F4_INTFID</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">FORM</span><span class="w"> </span><span class="nf">frm_f4_intfid</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="c1">&quot; SELECT</span>
<span class="w">  </span><span class="c1">&quot;   ztintf~sysnm,</span>
<span class="w">  </span><span class="c1">&quot;   ztintf~sysid,</span>
<span class="w">  </span><span class="c1">&quot;   ztintf~funcname,</span>
<span class="w">  </span><span class="c1">&quot;   tftit~stext</span>
<span class="w">  </span><span class="c1">&quot;   FROM ztintf</span>
<span class="w">  </span><span class="c1">&quot;   JOIN tftit ON spras = &#39;1&#39;</span>
<span class="w">  </span><span class="c1">&quot;             AND ztintf~funcname = tftit~funcname</span>
<span class="w">  </span><span class="c1">&quot;   INTO TABLE @DATA(lt_ztintf).</span>
<span class="w">  </span><span class="c1">&quot; </span>
<span class="w">  </span><span class="c1">&quot; DATA l_dynprofield TYPE dynfnam.</span>
<span class="w">  </span><span class="c1">&quot; GET CURSOR FIELD l_dynprofield.</span>
<span class="w">  </span><span class="c1">&quot; </span>
<span class="w">  </span><span class="c1">&quot; CALL FUNCTION &#39;F4IF_INT_TABLE_VALUE_REQUEST&#39;</span>
<span class="w">  </span><span class="c1">&quot;   EXPORTING</span>
<span class="w">  </span><span class="c1">&quot;     retfield        = &#39;SYSID&#39;</span>
<span class="w">  </span><span class="c1">&quot;     value_org       = &#39;S&#39;</span>
<span class="w">  </span><span class="c1">&quot;     dynprofield     = l_dynprofield</span>
<span class="w">  </span><span class="c1">&quot;     dynpprog        = sy-repid</span>
<span class="w">  </span><span class="c1">&quot;     dynpnr          = sy-dynnr</span>
<span class="w">  </span><span class="c1">&quot;   TABLES</span>
<span class="w">  </span><span class="c1">&quot;     value_tab       = lt_ztintf</span>
<span class="w">  </span><span class="c1">&quot;   EXCEPTIONS</span>
<span class="w">  </span><span class="c1">&quot;     parameter_error = 1</span>
<span class="w">  </span><span class="c1">&quot;     no_values_found = 2</span>
<span class="w">  </span><span class="c1">&quot;     OTHERS          = 3.</span>
<span class="w">  </span><span class="c1">&quot; IF sy-subrc &lt;&gt; 0.</span>
<span class="w">  </span><span class="c1">&quot;   MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno</span>
<span class="w">  </span><span class="c1">&quot;           WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.</span>
<span class="w">  </span><span class="c1">&quot; ENDIF.</span>

<span class="k">ENDFORM</span><span class="p">.</span><span class="w"></span>

<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; 初始化</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">INITIALIZATION</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PERFORM</span><span class="w"> </span><span class="nf">frm_init</span><span class="p">.</span><span class="w"></span>

<span class="c1">**&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">**&amp; 自定义日志表接口ID搜索帮助</span><span class="w"></span>
<span class="c1">**&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*AT SELECTION-SCREEN ON VALUE-REQUEST FOR s_intfid-low.</span><span class="w"></span>
<span class="c1">*  PERFORM frm_f4_intfid.</span><span class="w"></span>
<span class="c1">*</span><span class="w"></span>
<span class="c1">*AT SELECTION-SCREEN ON VALUE-REQUEST FOR s_intfid-high.</span><span class="w"></span>
<span class="c1">*  PERFORM frm_f4_intfid.</span><span class="w"></span>

<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; START-OF-SELECTION</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">START-OF-SELECTION</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PERFORM</span><span class="w"> </span><span class="nf">frm_main</span><span class="p">.</span><span class="w"></span>

<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; MODULE STATUS_9000 OUTPUT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">MODULE</span><span class="w"> </span><span class="nf">status_9000</span><span class="w"> </span><span class="k">OUTPUT</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="nv">go_alv</span><span class="o">-&gt;</span><span class="nf">pbo</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">  </span><span class="k">SET PF-STATUS</span><span class="w"> </span><span class="s1">&#39;STATUS&#39;</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDMODULE</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; MODULE USER_COMMAND_9000  INPUT</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">MODULE</span><span class="w"> </span><span class="nf">user_command_9000</span><span class="w"> </span><span class="k">INPUT</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">CASE</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">ucomm</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;REDO&#39;</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 错误重处理</span>
<span class="w">      </span><span class="k">PERFORM</span><span class="w"> </span><span class="nf">frm_redo</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;&amp;F03&#39;</span><span class="w"> </span><span class="ow">OR</span><span class="w"> </span><span class="s1">&#39;&amp;F15&#39;</span><span class="w"> </span><span class="ow">OR</span><span class="w"> </span><span class="s1">&#39;&amp;F12&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">LEAVE TO SCREEN</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">WHEN</span><span class="w"> </span><span class="k">OTHERS</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">go_alv</span><span class="o">-&gt;</span><span class="nf">pai</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDCASE</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDMODULE</span><span class="p">.</span><span class="w"></span>
</code></pre></div>

</details>

<details>
  <summary>LIF_LOG实例参考代码</summary>

<div class="highlight"><pre><span></span><code><span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_LOG_CUSTOM</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_log_custom</span><span class="w"> </span><span class="k">DEFINITION</span><span class="w"> </span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">PUBLIC SECTION</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">INTERFACES</span><span class="w"> </span><span class="nv">lif_log</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LCL_LOG_CUSTOM</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="k">CLASS</span><span class="w"> </span><span class="nv">lcl_log_custom</span><span class="w"> </span><span class="k">IMPLEMENTATION</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; lif_log~get_log_kind</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_log~get_log_kind</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">r_log_kind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;CUSTOM&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LIF_LOG~GET_DATA</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_log~get_data</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_log</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_log</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">ls_log_rawdata</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_log_rawdata</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_zitem</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">ty_log</span><span class="o">-</span><span class="nv">zitem</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">SELECT</span><span class="w"></span>
<span class="w">      </span><span class="nv">ztintf~sysid</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nv">ztintf~funcname</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="nv">tftit~stext</span><span class="w"></span>
<span class="w">      </span><span class="k">FROM</span><span class="w"> </span><span class="nv">ztintf</span><span class="w"></span>
<span class="w">      </span><span class="k">JOIN</span><span class="w"> </span><span class="nv">tftit</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="nv">ztintf~funcname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">tftit~funcname</span><span class="w"></span>
<span class="w">                </span><span class="ow">AND</span><span class="w"> </span><span class="nv">tftit~spras</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="w"></span>
<span class="w">      </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="err">@</span><span class="nv">DATA</span><span class="p">(</span><span class="nv">lt_ztintf</span><span class="p">).</span><span class="w"></span>
<span class="w">    </span><span class="k">SORT</span><span class="w"> </span><span class="nv">lt_ztintf</span><span class="w"> </span><span class="nv">BY</span><span class="w"> </span><span class="nv">sysid</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="nv">ztlog</span><span class="w"></span>
<span class="w">    </span><span class="k">WHERE</span><span class="w"> </span><span class="nv">zguid</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="err">@</span><span class="nv">s_uuid</span><span class="w"></span>
<span class="w">      </span><span class="ow">AND</span><span class="w"> </span><span class="nv">intfid</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="err">@</span><span class="nv">s_intfid</span><span class="w"></span>
<span class="w">      </span><span class="ow">AND</span><span class="w"> </span><span class="nv">zsender</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="err">@</span><span class="nv">s_snd</span><span class="w"></span>
<span class="w">      </span><span class="ow">AND</span><span class="w"> </span><span class="nv">zreceiver</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="err">@</span><span class="nv">s_rcv</span><span class="w"></span>
<span class="w">      </span><span class="ow">AND</span><span class="w"> </span><span class="nv">datum</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="err">@</span><span class="nv">s_date</span><span class="w"></span>
<span class="w">      </span><span class="ow">AND</span><span class="w"> </span><span class="nv">uzeit</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="err">@</span><span class="nv">s_time</span><span class="w"></span>
<span class="w">      </span><span class="ow">AND</span><span class="w"> </span><span class="nv">zstatus</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="err">@</span><span class="nv">s_mtype</span><span class="w"></span>
<span class="w">      </span><span class="ow">AND</span><span class="w"> </span><span class="nv">funcname</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="err">@</span><span class="nv">s_func</span><span class="w"></span>
<span class="w">    </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="err">@</span><span class="nv">DATA</span><span class="p">(</span><span class="nv">lt_ztlog</span><span class="p">).</span><span class="w"></span>

<span class="w">    </span><span class="k">SORT</span><span class="w"> </span><span class="nv">lt_ztlog</span><span class="w"> </span><span class="nv">BY</span><span class="w"> </span><span class="nv">zguid</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">LOOP AT </span><span class="nv">lt_ztlog</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">ls_ztlog</span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">AT NEW</span><span class="w"> </span><span class="nv">zguid</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">l_zitem</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDAT</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">l_zitem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_zitem</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">.</span><span class="w"></span>

<span class="w">      </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_log</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_ztlog</span><span class="o">-</span><span class="nv">zguid</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">zitem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_zitem</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">intf_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_ztlog</span><span class="o">-</span><span class="nv">intfid</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 接口ID</span>
<span class="w">      </span><span class="k">READ</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">lt_ztintf</span><span class="w"> </span><span class="k">REFERENCE INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lr_ztintf</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="k">WITH</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="nv">sysid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_ztlog</span><span class="o">-</span><span class="nv">intfid</span><span class="w"> </span><span class="nv">BINARY</span><span class="w"> </span><span class="k">SEARCH</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">subrc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">func_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_ztintf</span><span class="o">-&gt;</span><span class="nv">funcname</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">func_text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">lr_ztintf</span><span class="o">-&gt;</span><span class="nv">stext</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">io_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_ztlog</span><span class="o">-</span><span class="nv">zzio</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 接口方向</span>
<span class="w">      </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">zsender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_ztlog</span><span class="o">-</span><span class="nv">zsender</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 发送方</span>
<span class="w">      </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">zreceiver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_ztlog</span><span class="o">-</span><span class="nv">zreceiver</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 接受方</span>
<span class="w">      </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">zdate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_ztlog</span><span class="o">-</span><span class="nv">datum</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">ztime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_ztlog</span><span class="o">-</span><span class="nv">uzeit</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">zuser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_ztlog</span><span class="o">-</span><span class="nv">uname</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">mtype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_ztlog</span><span class="o">-</span><span class="nv">zstatus</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">zconut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_ztlog</span><span class="o">-</span><span class="nv">zcount</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 条目统计</span>
<span class="w">      </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_log</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">gt_log</span><span class="p">.</span><span class="w"></span>

<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">ls_ztlog</span><span class="o">-</span><span class="nv">zjson</span><span class="w"> </span><span class="ow">IS NOT INITIAL</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">CLEAR</span><span class="w"> </span><span class="nv">ls_log_rawdata</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">ls_log_rawdata</span><span class="o">-</span><span class="nv">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_ztlog</span><span class="o">-</span><span class="nv">zguid</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">ls_log_rawdata</span><span class="o">-</span><span class="nv">zitem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_zitem</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">ls_log_rawdata</span><span class="o">-</span><span class="nv">zformat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;JSON&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">ls_log_rawdata</span><span class="o">-</span><span class="nv">zraw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_ztlog</span><span class="o">-</span><span class="nv">zjson</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 原始数据</span>
<span class="w">        </span><span class="k">INSERT</span><span class="w"> </span><span class="nv">ls_log_rawdata</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">gt_log_rawdata</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; LIF_LOG~REDO</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_log~redo</span><span class="p">.</span><span class="w"></span>

<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_fsyid</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_fname</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_sdata</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_infud</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="w"> </span><span class="nv">l_ftname</span><span class="w"> </span><span class="k">TYPE </span><span class="nv">string</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">DATA</span><span class="p">(</span><span class="nv">lo_proxy</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">NEW</span><span class="w"> </span><span class="nv">zcl_intf_proxy</span><span class="p">(</span><span class="w"> </span><span class="p">).</span><span class="w"></span>

<span class="w">    </span><span class="k">LOOP AT </span><span class="nv">it_uuid</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">l_uuid</span><span class="p">).</span><span class="w"></span>
<span class="w">      </span><span class="k">READ</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">gt_log</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">ls_log</span><span class="p">)</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">KEY</span><span class="w"></span>
<span class="w">      </span><span class="nv">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_uuid</span><span class="w"></span>
<span class="w">      </span><span class="nv">io_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;2&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">IF</span><span class="w"> </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">mtype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;S&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="nv">lcl_progress</span><span class="o">=&gt;</span><span class="nf">step</span><span class="p">(</span><span class="w"> </span><span class="p">|{</span><span class="w"> </span><span class="nv">l_uuid</span><span class="w"> </span><span class="p">}</span><span class="s1">不需要重处理</span><span class="p">|</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">        </span><span class="k">CONTINUE</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ELSE</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">READ</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">gt_log</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="nv">ls_log</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">KEY</span><span class="w"></span>
<span class="w">        </span><span class="nv">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_uuid</span><span class="w"></span>
<span class="w">        </span><span class="nv">io_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">IF</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">subrc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">READ</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="nv">gt_log_rawdata</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="k">DATA</span><span class="p">(</span><span class="nv">ls_log_rawdata</span><span class="p">)</span><span class="w"> </span><span class="k">WITH</span><span class="w"> </span><span class="k">KEY</span><span class="w"></span>
<span class="w">          </span><span class="nv">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">uuid</span><span class="w"></span>
<span class="w">          </span><span class="nv">zitem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">zitem</span><span class="w"></span>
<span class="w">          </span><span class="nv">BINARY</span><span class="w"> </span><span class="k">SEARCH</span><span class="p">.</span><span class="w"></span>
<span class="w">          </span><span class="k">IF</span><span class="w"> </span><span class="nv">sy</span><span class="o">-</span><span class="nv">subrc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="nv">l_fsyid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">zsender</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 外部系统</span>
<span class="w">            </span><span class="nv">l_fname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">intf_id</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 接口ID</span>
<span class="w">            </span><span class="nv">l_sdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_log_rawdata</span><span class="o">-</span><span class="nv">zraw</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 请求报文</span>
<span class="w">            </span><span class="nv">l_infud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">uuid</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 报文ID</span>
<span class="w">            </span><span class="nv">l_ftname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">func_name</span><span class="p">.</span><span class="w"> </span><span class="c1">&quot; 对应函数名</span>
<span class="w">            </span><span class="k">CASE</span><span class="w"> </span><span class="nv">ls_log</span><span class="o">-</span><span class="nv">zsender</span><span class="p">.</span><span class="w"></span>
<span class="w">              </span><span class="k">WHEN</span><span class="w"> </span><span class="s1">&#39;SAP&#39;</span><span class="p">.</span><span class="w"></span>
<span class="w">                </span><span class="k">CALL METHOD</span><span class="w"> </span><span class="nv">lo_proxy</span><span class="o">-&gt;</span><span class="nv">sap_data_to_out</span><span class="w"></span>
<span class="w">                  </span><span class="k">EXPORTING</span><span class="w"></span>
<span class="w">                    </span><span class="nv">iv_fname</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">l_fname</span><span class="w"></span>
<span class="w">                    </span><span class="nv">iv_sdata</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">l_sdata</span><span class="w"></span>
<span class="w">                    </span><span class="nv">iv_infud</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nv">l_infud</span><span class="w"></span>
<span class="w">                    </span><span class="nv">iv_ftname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_ftname</span><span class="p">.</span><span class="w"></span>
<span class="w">              </span><span class="k">WHEN</span><span class="w"> </span><span class="k">OTHERS</span><span class="p">.</span><span class="w"></span>
<span class="w">                </span><span class="k">CALL METHOD</span><span class="w"> </span><span class="nv">lo_proxy</span><span class="o">-&gt;</span><span class="nv">out_data_to_sap</span><span class="w"></span>
<span class="w">                  </span><span class="k">EXPORTING</span><span class="w"></span>
<span class="w">                    </span><span class="nv">iv_fsyid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_fsyid</span><span class="w"></span>
<span class="w">                    </span><span class="nv">iv_fname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_fname</span><span class="w"></span>
<span class="w">                    </span><span class="nv">iv_sdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_sdata</span><span class="w"></span>
<span class="w">                    </span><span class="nv">iv_infud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">l_infud</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="k">ENDCASE</span><span class="p">.</span><span class="w"></span>
<span class="w">            </span><span class="nv">lcl_progress</span><span class="o">=&gt;</span><span class="nf">step</span><span class="p">(</span><span class="w"> </span><span class="p">|{</span><span class="w"> </span><span class="nv">l_uuid</span><span class="w"> </span><span class="p">}</span><span class="s1">已提交重处理</span><span class="p">|</span><span class="w"> </span><span class="p">).</span><span class="w"></span>
<span class="w">          </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">        </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">      </span><span class="k">ENDIF</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="k">ENDLOOP</span><span class="p">.</span><span class="w"></span>

<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="c1">*&amp; lif_log~check_active</span><span class="w"></span>
<span class="c1">*&amp;---------------------------------------------------------------------*</span><span class="w"></span>
<span class="w">  </span><span class="k">METHOD</span><span class="w"> </span><span class="nf">lif_log~check_active</span><span class="p">.</span><span class="w"></span>
<span class="w">    </span><span class="nv">r_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">p_custom</span><span class="p">.</span><span class="w"></span>
<span class="w">  </span><span class="k">ENDMETHOD</span><span class="p">.</span><span class="w"></span>
<span class="k">ENDCLASS</span><span class="p">.</span><span class="w"></span>
</code></pre></div>

</details>





              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../stock/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 库存报表" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              库存报表
            </div>
          </div>
        </a>
      
      
        
        <a href="../../others/" class="md-footer__link md-footer__link--next" aria-label="Next: 其他概述" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              其他概述
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.2ab50757.min.js"></script>
      
    
  </body>
</html>